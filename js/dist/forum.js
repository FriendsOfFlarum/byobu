module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=47)}([function(t,e){t.exports=flarum.core.compat["forum/app"]},function(t,e,n){"use strict";function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}n.d(e,"a",(function(){return s}))},function(t,e){t.exports=flarum.core.compat["common/models/User"]},,function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,e){t.exports=flarum.core.compat["common/models/Group"]},function(t,e){t.exports=flarum.core.compat["forum/components/Notification"]},function(t,e){t.exports=flarum.core.compat["common/utils/classList"]},function(t,e){t.exports=flarum.core.compat["forum/components/EventPost"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Badge"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/helpers/highlight"]},function(t,e){t.exports=flarum.core.compat["forum/components/UserPage"]},function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["forum/components/SettingsPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Switch"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["common/utils/Stream"]},function(t,e){t.exports=flarum.core.compat["forum/states/SearchState"]},function(t,e){t.exports=flarum.core.compat["forum/components/Search"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,e){t.exports=flarum.core.compat["tags/components/TagDiscussionModal"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["forum/utils/UserControls"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionComposer"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["forum/components/LogInModal"]},function(t,e){t.exports=flarum.core.compat["forum/components/NotificationGrid"]},function(t,e){t.exports=flarum.core.compat["components/Notification"]},,,function(t,e,n){"use strict";n.r(e),n.d(e,"modals",(function(){return ue})),n.d(e,"discussions",(function(){return pe}));var o=n(0),s=n.n(o),r=n(1),i=n(12),a=n.n(i),c=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e)};var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){return"fof-byobu.forum.post.recipients_modified.made_public"},e}(a.a),u=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e)};var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){return"fof-byobu.forum.post.recipients_modified.removed_self"},e}(a.a);function p(t,e){if(null==t)return{};var n,o,s={},r=Object.keys(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||(s[n]=t[n]);return s}var f=n(2),l=n.n(f),d=n(11),b=n.n(d),h=n(17),y=n.n(h),v=n(9),g=n.n(v),x=n(13),_=n.n(x),P=n(21),R=["recipient","link"],w=function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e.prototype.view=function(t){var e,n=this.attrs,o=n.recipient,r=n.link,i=p(n,R);if(i.style=i.style||{},i.className=b()("RecipientLabel",null==i?void 0:i.className),r&&o instanceof l.a&&(i.href=s.a.route.user(o)),o instanceof l.a){var a,c;e=y()(o),i.href||o.id()===(null==s.a||null==(a=s.a.session)||null==(c=a.user)?void 0:c.id())||(i.href=s.a.route.user(o))}else{if(o instanceof g.a)return m("span",{class:i.className},o.namePlural());i.className+=" none",e=s.a.translator.trans("core.lib.username.deleted_text")}return m(_.a,i,e)},e}(n.n(P).a),D=["link","className"];function j(t,e){void 0===e&&(e={});var n=e,o=n.link,s=n.className,r=p(n,D);return r.className=b()("RecipientsLabel",s),m("span",r,null==t?void 0:t.map((function(t,e){var n=t instanceof l.a?"u":"g";return m(w,{key:n+"-"+e,recipient:t,link:o})})),!t&&m(w,null))}var k=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t),e.initAttrs=function(e){function n(t,e,n){return t.filter((function(t){return-1===e.indexOf(t)})).map((function(t){return s.a.store.getById(n,t)}))}t.initAttrs.call(this,e);var o=e.post.content();if(o.new||2!=o.length){var r=n(o.new.users,o.old.users,"users"),i=n(o.old.users,o.new.users,"users"),a=n(o.new.groups,o.old.groups,"groups"),c=n(o.old.groups,o.new.groups,"groups");e.added=r.concat(a),e.removed=i.concat(c)}else{var u=e.post.content()[0],p=e.post.content()[1];e.added=n(p,u,"users"),e.removed=n(u,p,"users")}};var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){var t="fof-byobu.forum.post.recipients_modified.";return this.attrs.added.length?this.attrs.removed.length?t+"added_and_removed":t+"added":t+"removed"},n.descriptionData=function(){var t={};return this.attrs.added.length&&(t.added=j(this.attrs.added,{link:!0})),this.attrs.removed.length&&(t.removed=j(this.attrs.removed,{link:!0})),t},e}(a.a),O=n(4),N=n(22),U=n.n(N),S=n(23),A=n.n(S),C=function(){Object(O.extend)(U.a.prototype,"privacyItems",(function(t){var e=this;t.add("byobu-block-dm",A.a.component({state:this.user.blocksPd(),onchange:function(t){e.blocksPdLoading=!0,e.user.save({blocksPd:t}).then((function(){e.blocksPdLoading=!1,m.redraw()}))},loading:this.blocksPdLoading},s.a.translator.trans("fof-byobu.forum.user.settings.block_pd")))}))};var M=n(6),I=n.n(M),G=n(16),L=n.n(G),B=n(8),T=n.n(B),E=n(7),q=n.n(E),V=n(24),K=n.n(V),F=n(25),W=n.n(F),z=n(14),H=n.n(z),J=n(26),Q=n.n(J),X=n(5),Y=n.n(X),Z=n(27),tt=n.n(Z),et=n(28),nt=n.n(et),ot=n(29),st=n.n(ot),rt=n(30),it=n.n(rt),at=n(31),ct=n.n(at);function ut(){return(ut=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}var pt=n(18),ft=n.n(pt),lt=n(32),mt=n.n(lt),dt=function(){function t(){}var e=t.prototype;return e.view=function(t){var e=this;if(!(t.length<3||this.loading)){if(s.a.cache.byobuResults||(s.a.cache.byobuResults=[]),this.query=t,s.a.cache.byobuResults[this.query])return[m("li",{className:"Dropdown-header"},s.a.translator.trans("core.forum.search.users_heading")),s.a.cache.byobuResults[this.query].map((function(t){var n=y()(t),o=[ft()(n.text,e.query)];return m("li",{className:"SearchResult","data-index":"users:"+t.id()},m("a",{"data-index":"users:"+t.id()},mt()(t),ut({},n,{text:void 0,children:o})))}))];this.loading=!0,s.a.cache.byobuResults[this.query]=[],s.a.store.find("users",{filter:{q:this.query+" allows-pd"},page:{limit:5}}).then(this.pushResults.bind(this))}},e.pushResults=function(t){var e=this;t.payload.data.map((function(t){var n=s.a.store.getById("users",t.id);s.a.cache.byobuResults[e.query].push(n)})),this.loading=!1,m.redraw()},t}(),bt=function(){function t(){}var e=t.prototype;return e.search=function(t){return s.a.store.find("groups",{filter:{q:t},page:{limit:5}})},e.view=function(t){t=t.toLowerCase();var e=s.a.store.all("groups").filter((function(e){return e.namePlural().toLowerCase().substr(0,t.length)===t}));return e.length?[m("li",{className:"Dropdown-header"},s.a.translator.trans("fof-byobu.forum.search.headings.groups")),e.map((function(e){var n=e.namePlural(),o=ft()(n,t);return m("li",{className:"SearchResult","data-index":"groups:"+e.id()},m("a",{"data-index":"groups:"+e.id()},m("span",{class:"groupName"},o)))}))]:""},t}(),ht=n(33),yt=n.n(ht),vt=n(34),gt=n.n(vt),xt=n(35),_t=n.n(xt),Pt=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).inputUuid=void 0,e}Object(r.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.inputUuid=Math.random().toString(36).substring(2)},n.oncreate=function(e){var n=this;t.prototype.oncreate.call(this,e);var o=this;this.$(".Search-results").on("click",(function(t){var e=n.$(".SearchResult.active");o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),this.$(".Search-results").on("touchstart",(function(t){var e=n.$(t.target.parentNode);o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),$(".RecipientsInput").on("input",(function(){clearTimeout(n.typingTimer),n.doSearch=!1,n.typingTimer=setTimeout((function(){n.doSearch=!0,m.redraw()}),900)})).on("keydown",(function(){clearTimeout(n.typingTimer)})),t.prototype.oncreate.call(this,e)},n.view=function(){var t=this;void 0===this.state.getValue()&&this.state.setValue("");var e=this.state.getValue()&&this.state.getValue().length>=3;return this.sources||(this.sources=this.sourceItems().toArray()),m("div",{role:"search",className:"Search"},m("div",{className:"RecipientsInput-selected RecipientsLabel","aria-live":"polite"},m("h4",null,s.a.translator.trans("fof-byobu.forum.modal.labels.selected_users")),m("p",null,s.a.translator.trans("fof-byobu.forum.modal.help.selected_users")),this.attrs.selected().toArray().map((function(e){return m(_t.a,{text:s.a.translator.trans("fof-byobu.forum.modal.help.click_user_to_remove_tooltip")},m(w,{"data-container":"body",recipient:e,onclick:function(n){return t.removeRecipient(e,n)}}))}))),m("div",{className:"Form-group"},m("label",{for:"byobu-addrecipient-search-input-"+this.inputUuid},s.a.translator.trans("fof-byobu.forum.modal.labels.search_field")),m("div",{className:"AddRecipientModal-form-input Search-input"},m("input",{id:"byobu-addrecipient-search-input-"+this.inputUuid,className:b()("RecipientsInput","FormControl",{open:!!this.state.getValue(),focused:!!this.state.getValue(),active:!!this.state.getValue(),loading:!!this.loadingSources}),oncreate:function(t){return t.dom.focus()},type:"search",placeholder:yt()(s.a.translator.trans("fof-byobu.forum.input.search_recipients")),value:this.state.getValue(),oninput:function(e){return t.state.setValue(e.target.value)},onfocus:function(){return t.hasFocus=!0},onblur:function(){return t.hasFocus=!1}}),m("ul",{className:b()("Dropdown-menu","Search-results","fade",{in:!!e})},this.doSearch?this.sources.map((function(e){return e.view(t.state.getValue())})):gt.a.component({size:"tiny",className:"Button Button--icon Button--link"})))))},n.sourceItems=function(){var t=new Y.a;return(!this.attrs.discussion&&s.a.forum.attribute("canStartPrivateDiscussionWithUsers")||this.attrs.discussion&&this.attrs.discussion.canEditUserRecipients())&&t.add("users",new dt),(!this.attrs.discussion&&s.a.forum.attribute("canStartPrivateDiscussionWithGroups")||this.attrs.discussion&&this.attrs.discussion.canEditGroupRecipients())&&t.add("groups",new bt),t},n.addRecipient=function(t){var e=t.split(":"),n=e[0],o=e[1],s=this.findRecipient(n,o);this.attrs.selected().add(t,s),this.state.clear()},n.removeRecipient=function(t,e){var n;e.preventDefault(),t instanceof l.a&&(n="users"),t instanceof g.a&&(n="groups"),this.attrs.selected().remove(n+":"+t.id())},n.findRecipient=function(t,e){return s.a.store.getById(t,e)},e}(ct.a),Rt=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.selected=st()(new Y.a),this.attrs.discussion?this.assignInitialRecipients(this.attrs.discussion):this.attrs.selectedRecipients&&this.attrs.selectedRecipients.toArray().length>0?this.selected().merge(this.attrs.selectedRecipients):this.selected().add("users:"+s.a.session.user.id(),s.a.session.user),this.recipientSearch=new it.a},n.isDismissible=function(){return!1},n.assignInitialRecipients=function(t){var e=this;t.recipientUsers().map((function(t){e.selected().add("users:"+t.id(),t)})),t.recipientGroups().map((function(t){e.selected().add("groups:"+t.id(),t)}))},n.className=function(){return"AddRecipientModal"},n.title=function(){return this.attrs.discussion?s.a.translator.trans("fof-byobu.forum.modal.titles.update_recipients",{title:m("em",null,this.attrs.discussion.title())}):s.a.translator.trans("fof-byobu.forum.modal.titles.add_recipients")},n.helpText=function(){return this.attrs.discussion?s.a.translator.trans("fof-byobu.forum.modal.help.update_recipients"):s.a.translator.trans("fof-byobu.forum.modal.help.add_recipients")},n.content=function(){return[m("div",{className:"Modal-body"},m("div",{class:"AddRecipientModal-help"},this.helpText()),m("div",{className:"AddRecipientModal-form"},Pt.component({state:this.recipientSearch,selected:this.selected,discussion:this.attrs.discussion}),m("div",{className:"AddRecipientModal-form-submit App-primaryControl"},q.a.component({type:"submit",className:"Button Button--primary",icon:"fas fa-check"},s.a.translator.trans("fof-byobu.forum.buttons.submit")),q.a.component({onclick:this.hide.bind(this),className:"Button Button--cancel"},s.a.translator.trans("fof-byobu.forum.buttons.cancel")))))]},n.select=function(t){(t.metaKey||t.ctrlKey||-1!==this.selected.indexOf(this.index))&&this.selected().length&&this.$("form").submit()},n.onsubmit=function(t){t.preventDefault();var e=this.attrs.discussion,n=this.selected(),o=[],r=[];n.toArray().forEach((function(t){t instanceof l.a&&r.push(t),t instanceof g.a&&o.push(t)})),e&&e.save({relationships:{recipientUsers:r,recipientGroups:o}}).then((function(){s.a.current instanceof nt.a&&s.a.current.stream.update(),m.redraw()})),this.attrs.onsubmit&&this.attrs.onsubmit(n),s.a.modal.close(),this.attrs.discussion||s.a.composer.show(),t.redraw=!1},e}(tt.a),wt=n(36),Dt=function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e.prototype.onsubmit=function(t){t.preventDefault();var e=this.selected;this.attrs.resolve&&this.attrs.resolve(e),this.hide()},e}(n.n(wt).a);Dt.isDismissible=!1;var jt=n(37),kt=n.n(jt),Ot=function(){T.a.prototype.recipientUsers=I.a.hasMany("recipientUsers"),T.a.prototype.oldRecipientUsers=I.a.hasMany("oldRecipientUsers"),T.a.prototype.recipientGroups=I.a.hasMany("recipientGroups"),T.a.prototype.oldRecipientGroups=I.a.hasMany("oldRecipientGroups"),T.a.prototype.canEditRecipients=I.a.attribute("canEditRecipients"),T.a.prototype.canEditUserRecipients=I.a.attribute("canEditUserRecipients"),T.a.prototype.canEditGroupRecipients=I.a.attribute("canEditGroupRecipients"),T.a.prototype.canEditGroupRecipients=I.a.attribute("canEditGroupRecipients"),T.a.prototype.canMakePublic=I.a.attribute("canMakePublic"),T.a.prototype.isPrivateDiscussion=I.a.attribute("isPrivateDiscussion"),Object(O.extend)(T.a.prototype,"badges",(function(t){(this.recipientUsers().length||this.recipientGroups().length)&&t.add("private",L.a.component({type:"private",label:s.a.translator.trans("fof-byobu.forum.badges.is_private.tooltip"),icon:s.a.forum.data.attributes["byobu.icon-badge"]}),10)})),Object(O.extend)(K.a.prototype,"infoItems",(function(t){var e=this.attrs.discussion;Nt(e,t,!0)})),Object(O.extend)(W.a.prototype,"items",(function(t){var e=this.attrs.discussion;Nt(e,t,!1)})),Object(O.extend)(H.a.prototype,"requestParams",(function(t){t.include.push("recipientUsers"),t.include.push("recipientGroups")})),Object(O.extend)(Q.a,"moderationControls",(function(t,e){e.canEditRecipients()&&t.add("recipients",q.a.component({icon:s.a.forum.data.attributes["byobu.icon-badge"],onclick:function(){return s.a.modal.show(Rt,{discussion:e})}},s.a.translator.trans("fof-byobu.forum.buttons.edit_recipients"))),e&&e.recipientUsers().find((function(t){return t.id()===s.a.session.user.id()}))&&(t.add("remove",q.a.component({icon:"fas fa-user-slash",onclick:function(){if(e){var t=new Y.a;e.recipientUsers().map((function(e){s.a.session.user.id()!==e.id()&&t.add("users:"+e.id(),e)}));var n=[],o=[];t.toArray().forEach((function(t){t instanceof l.a&&o.push(t),t instanceof g.a&&n.push(t)})),e.save({relationships:{recipientUsers:o,recipientGroups:n}}).then((function(){return s.a.history.back()}))}}},s.a.translator.trans("fof-byobu.forum.buttons.remove_from_discussion"))),null!=e&&null!=e.isPrivateDiscussion&&e.isPrivateDiscussion()&&null!=e&&null!=e.canMakePublic&&e.canMakePublic()&&t.add("transform-public",m(q.a,{icon:"far fa-eye",onclick:function(){if(e&&confirm(s.a.translator.trans("fof-byobu.forum.confirm.make_public"))){var t=[],n=[];flarum.extensions["flarum-tags"]?new Promise((function(t,n){s.a.modal.show(Dt,{discussion:e,resolve:t,reject:n})})).then((function(o){e.save({relationships:{recipientUsers:n,recipientGroups:t},public:e.id()}).then((function(){e.save({relationships:{tags:o}}).then((function(){s.a.current.matches(kt.a)&&s.a.current.get("stream").update(),m.redraw()}))}))})):e.save({relationships:{recipientUsers:n,recipientGroups:t},public:e.id()}).then((function(){return m.redraw()}))}}},s.a.translator.trans("fof-byobu.forum.buttons.make_public"))))}))},Nt=function(t,e,n){var o=[];t.recipientUsers().length&&(o=o.concat(t.recipientUsers())),t.recipientGroups().length&&(o=o.concat(t.recipientGroups())),o&&o.length&&(n?e.add("recipients",j(o),10):e.add("recipients",j(o,{link:!0}),4))};var Ut=n(38),St=n.n(Ut),At=n(39);var Ct=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this)._isByobuComposer=!0,e}Object(r.a)(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e),e.titlePlaceholder=s.a.translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),e.submitLabel=s.a.translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")};var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.composer.fields.recipients=this.attrs.recipients||new Y.a,this.composer.fields.recipientUsers=this.attrs.recipientUsers||[],this.composer.fields.recipientGroups=this.attrs.recipientGroups||[];var n=m.route.param("username");void 0!==n&&this.addDefaultRecipients(n)},n.data=function(){var e=t.prototype.data.call(this),n=[],o=[];return void 0!==this.composer.fields.recipients&&this.composer.fields.recipients.toArray().forEach((function(t){t instanceof l.a&&n.push(t),t instanceof g.a&&o.push(t)})),e.relationships=e.relationships||{},n.length&&(e.relationships.recipientUsers=n),o.length&&(e.relationships.recipientGroups=o),delete e.relationships.tags,e},n.chooseRecipients=function(){var t=this;s.a.modal.show(Rt,{selectedRecipients:this.composer.fields.recipients,onsubmit:function(e){t.composer.fields.recipients=e,t.$(".RecipientsInput").focus()}})},n.headerItems=function(){var e=t.prototype.headerItems.call(this);if(e.remove("tags"),s.a.session.user&&s.a.forum.attribute("canStartPrivateDiscussion")){var n=this.composer.fields.recipients.toArray();e.add("recipients",m("a",{className:"PrivateDiscussionComposer-changeRecipients",onclick:this.chooseRecipients.bind(this)},n.length?function(t,e){void 0===e&&(e={}),e.style=e.style||{},e.className="RecipientLabel "+(e.className||"");var n=s.a.translator.trans("fof-byobu.forum.labels.recipients",{count:t});return m("span",e,m("span",{className:"RecipientLabel-text"},n))}(n.length):m("span",{className:"RecipientLabel none"},s.a.translator.trans("fof-byobu.forum.buttons.add_recipients"))),5)}return e},n.addDefaultRecipients=function(t){var e=s.a.store.getBy("users","username",t);this.composer.fields.recipients.add("users:"+s.a.session.user.id(),s.a.session.user),e.id()!==s.a.session.user.id()&&this.composer.fields.recipients.add("users:"+e.id(),e)},n.onsubmit=function(){if(this.loading=!0,this.composer.fields.recipients.toArray().length<2)this.chooseRecipients(),this.loading=!1;else{var t=this.data();s.a.store.createRecord("discussions").save(t).then((function(t){s.a.cache.discussionList&&s.a.cache.discussionList.refresh(),m.route.set(s.a.route.discussion(t)),s.a.composer.hide()}),this.loaded.bind(this))}},e}(n.n(At).a),Mt=n(19),It=n.n(Mt),Gt=function(){l.a.prototype.blocksPd=I.a.attribute("blocksPd"),l.a.prototype.cannotBeDirectMessaged=I.a.attribute("cannotBeDirectMessaged"),l.a.prototype.unreadPrivateMessagesCount=I.a.attribute("unreadPrivateMessagesCount"),Object(O.extend)(St.a,"userControls",(function(t,e){return s.a.session.user&&s.a.session.user.id()!==e.id()&&s.a.forum.attribute("canStartPrivateDiscussion")&&(!1===e.blocksPd()||s.a.forum.attribute("canStartPrivateDiscussionWithBlockers")&&e.cannotBeDirectMessaged())&&t.add("private-discussion",q.a.component({icon:s.a.forum.attribute("byobu.icon-badge"),onclick:function(t){return t.preventDefault(),new Promise((function(t){var n=new Y.a;return n.add("users:"+s.a.session.user.id(),s.a.session.user),n.add("users:"+e.id(),e),Ct.prototype.recipients=n,s.a.composer.load(Ct,{user:s.a.session.user,recipients:n,recipientUsers:n,titlePlaceholder:s.a.translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),submitLabel:s.a.translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")}),s.a.composer.show(),t(s.a.composer)}))}},s.a.translator.trans("fof-byobu.forum.buttons.send_pd",{username:e.username()}))),t})),Object(O.extend)(It.a.prototype,"navItems",(function(t){var e=s.a.route("byobuUserPrivate",{username:this.user.slug()});(s.a.session.user||m.route.get()===e)&&s.a.session.user!==this.user&&t.add("byobu",_.a.component({href:e,icon:s.a.forum.attribute("byobu.icon-badge")},s.a.translator.trans("fof-byobu.forum.user.byobu_link")),85)}))};var Lt=n(15),Bt=n.n(Lt),Tt=function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e}(H.a),Et=n(40),qt=n.n(Et),Vt=n(20),$t=n.n(Vt),Kt=n(41),Ft=function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e}(n.n(Kt).a);function Wt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var zt=n(42),Ht=n.n(zt),Jt=function(){function t(t){this.recipient=t}var e,n,o,r=t.prototype;return r.action=function(t){var e=this;return t.preventDefault(),new Promise((function(t,n){if(s.a.session.user){var o=new Y.a;return o.add("users:"+s.a.session.user.id(),s.a.session.user),e.recipient&&s.a.session.user.id()!==e.recipient.id()&&o.add("users:"+e.recipient.id(),e.recipient),s.a.composer.load(Ct,{user:s.a.session.user,recipients:o,recipientUsers:o}),s.a.composer.show(),t()}return s.a.modal.show(Ht.a),n()}))},r.component=function(){return q.a.component({icon:"fas fa-pen",className:"Button Button--primary IndexPage-newDiscussion",itemClassName:"App-primaryControl fof-byobu_primaryControl",onclick:this.action.bind(this),disabled:!this.canStartDiscussion},s.a.translator.trans(this.canStartDiscussion?"fof-byobu.forum.nav.start_button":"core.forum.index.cannot_start_discussion_button"))},e=t,(n=[{key:"canStartDiscussion",get:function(){return s.a.session.user&&s.a.forum.attribute("canStartPrivateDiscussion")}}])&&Wt(e.prototype,n),o&&Wt(e,o),t}(),Qt=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.changeSort("latest")},n.show=function(e){this.list=new Tt({q:"byobu:"+e.slug()+" is:private",sort:this.sort}),this.list.refresh(),t.prototype.show.call(this,e)},n.handleChangeSort=function(t,e){e.preventDefault(),this.changeSort(t)},n.changeSort=function(t){this.sort=t,this.loadUser(m.route.param("username"))},n.content=function(){return m("div",{className:"DiscussionsUserPage"},m("div",{className:"DiscussionsUserPage-toolbar"},m("ul",{className:"DiscussionsUserPage-toolbar-action"},$t()(this.actionItems().toArray())),m("ul",{className:"DiscussionsUserPage-toolbar-view"},$t()(this.viewItems().toArray()))),m(Ft,{state:this.list}))},n.actionItems=function(){var t=new Jt(this.user),e=new Y.a;return s.a.session.user&&s.a.forum.attribute("canStartPrivateDiscussion")&&e.add("start_private",t.component()),e},n.viewItems=function(){var t=this,e=new Y.a,n=this.list.sortMap(),o={};for(var r in n)o[r]=s.a.translator.trans("core.forum.index_sort."+r+"_button");return e.add("sort",qt.a.component({buttonClassName:"Button",label:o[this.sort]||Object.keys(n).map((function(t){return o[t]}))[0]},Object.keys(o).map((function(e){var s=o[e],r=(t.sort||Object.keys(n)[0])===e;return q.a.component({icon:!r||"fas fa-check",onclick:t.handleChangeSort.bind(t,e),active:r},s)})))),e},e}(It.a),Xt=function(){s.a.routes.byobuUserPrivate={path:"/u/:username/private",component:Qt},s.a.routes.byobuPrivate={path:"/private",component:Bt.a},Object(O.extend)(Bt.a.prototype,"navItems",(function(t){s.a.session.user&&t.add("privateDiscussions",_.a.component({icon:s.a.forum.data.attributes["byobu.icon-badge"],href:s.a.route("byobuPrivate")},s.a.translator.trans("fof-byobu.forum.nav.nav_item")),75)})),Object(O.extend)(Bt.a.prototype,"setTitle",(function(){"byobuPrivate"===s.a.current.get("routeName")&&s.a.setTitle(s.a.translator.trans("fof-byobu.forum.user.dropdown_label"))})),Object(O.extend)(H.a.prototype,"requestParams",(function(t){"byobuPrivate"===s.a.current.get("routeName")&&(t.filter.q=(t.filter.q||"")+" is:private",t.include.push("recipientUsers"),t.include.push("recipientGroups"))})),Object(O.extend)(Bt.a.prototype,"sidebarItems",(function(t){if("byobuPrivate"===s.a.current.get("routeName")){var e=new Jt;t.replace("newDiscussion",e.component())}}))},Yt=n(43),Zt=n.n(Yt),te=n(10),ee=n.n(te),ne=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return s.a.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return s.a.translator.trans("fof-byobu.forum.notifications.pd_text",{user:t})},e}(ee.a),oe=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.icon=function(){return"fas fa-reply"},n.href=function(){var t=this.attrs.notification,e=t.subject(),n=t.content()||{};return s.a.route.discussion(e,n.postNumber)},n.content=function(){var t=this.attrs.notification.fromUser();return s.a.translator.trans("fof-byobu.forum.notifications.pd_reply_text",{user:t})},e}(ee.a),se=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return s.a.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return s.a.translator.trans("fof-byobu.forum.notifications.pd_user_left_text",{user:t})},e}(ee.a),re=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return s.a.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return s.a.translator.trans("fof-byobu.forum.notifications.pd_added_text",{user:t})},e}(ee.a),ie=n(44),ae=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var n=e.prototype;return n.icon=function(){return s.a.forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.props.notification.subject();return s.a.route.discussion(t)},n.content=function(){var t=this.props.notification.fromUser();return s.a.translator.trans("fof-byobu.forum.notifications.pd_made_public_text",{user:t})},e}(n.n(ie).a),ce=function(){s.a.notificationComponents.byobuPrivateDiscussionCreated=ne,s.a.notificationComponents.byobuPrivateDiscussionReplied=oe,s.a.notificationComponents.byobuRecipientRemoved=se,s.a.notificationComponents.byobuPrivateDiscussionAdded=re,s.a.notificationComponents.byobuPrivateDiscussionMadePubic=ae,Object(O.extend)(Zt.a.prototype,"notificationTypes",(function(t){t.add("byobuPrivateDiscussionCreated",{name:"byobuPrivateDiscussionCreated",icon:s.a.forum.data.attributes["byobu.icon-badge"],label:s.a.translator.trans("fof-byobu.forum.notifications.pd_label")}),t.add("byobuPrivateDiscussionReplied",{name:"byobuPrivateDiscussionReplied",icon:s.a.forum.data.attributes["byobu.icon-badge"],label:s.a.translator.trans("fof-byobu.forum.notifications.pd_reply_label")}),t.add("byobuPrivateDiscussionAdded",{name:"byobuPrivateDiscussionAdded",icon:s.a.forum.data.attributes["byobu.icon-badge"],label:s.a.translator.trans("fof-byobu.forum.notifications.pd_added_label")}),t.add("byobuRecipientRemoved",{name:"byobuRecipientRemoved",icon:s.a.forum.data.attributes["byobu.icon-badge"],label:s.a.translator.trans("fof-byobu.forum.notifications.pd_user_left_label")})}))};var ue={AddRecipientModal:Rt},pe={PrivateDiscussionComposer:Ct,PrivateDiscussionList:Ft};s.a.initializers.add("fof-byobu",(function(){s.a.postComponents.recipientsModified=k,s.a.postComponents.recipientLeft=u,s.a.postComponents.madePublic=c,Ot(),C(),Gt(),Xt(),ce()}))}]);
//# sourceMappingURL=forum.js.map