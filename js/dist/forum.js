module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=45)}([function(t,e,n){"use strict";function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}n.d(e,"a",(function(){return s}))},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/models/User"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["forum/app"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,e){t.exports=flarum.core.compat["common/models/Group"]},function(t,e){t.exports=flarum.core.compat["forum/components/Notification"]},function(t,e){t.exports=flarum.core.compat["common/utils/classList"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["forum/states/DiscussionListState"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Badge"]},function(t,e){t.exports=flarum.core.compat["forum/components/EventPost"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/helpers/highlight"]},function(t,e){t.exports=flarum.core.compat["forum/components/UserPage"]},,function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["forum/components/SettingsPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Switch"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["common/utils/Stream"]},function(t,e){t.exports=flarum.core.compat["forum/states/SearchState"]},function(t,e){t.exports=flarum.core.compat["forum/components/Search"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,e){t.exports=flarum.core.compat["forum/utils/UserControls"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionComposer"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["forum/components/LogInModal"]},function(t,e){t.exports=flarum.core.compat["forum/components/NotificationGrid"]},,,,function(t,e,n){"use strict";n.r(e),n.d(e,"modals",(function(){return ne})),n.d(e,"discussions",(function(){return oe}));var o=n(0),s=n(15),r=n.n(s),i=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e)};var n=e.prototype;return n.icon=function(){return app.forum.data.attributes["byobu.icon-postAction"]},n.descriptionKey=function(){return"fof-byobu.forum.post.recipients_modified.removed_self"},e}(r.a);function a(t,e){if(null==t)return{};var n,o,s={},r=Object.keys(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||(s[n]=t[n]);return s}var c=n(2),u=n.n(c),p=n(10),f=n.n(p),l=n(16),d=n.n(l),b=n(8),h=n.n(b),y=n(11),v=n.n(y),g=n(4),x=n.n(g),_=n(21),R=["recipient","link"],P=function(t){function e(){return t.apply(this,arguments)||this}return Object(o.a)(e,t),e.prototype.view=function(t){var e,n=this.attrs,o=n.recipient,s=n.link,r=a(n,R);if(r.style=r.style||{},r.className=f()("RecipientLabel",null==r?void 0:r.className),s&&o instanceof u.a&&(r.href=x.a.route.user(o)),o instanceof u.a){var i,c;e=d()(o),r.href||o.id()===(null==x.a||null==(i=x.a.session)||null==(c=i.user)?void 0:c.id())||(r.href=x.a.route.user(o))}else{if(o instanceof h.a)return m("span",{class:r.className},o.namePlural());r.className+=" none",e=x.a.translator.trans("core.lib.username.deleted_text")}return m(v.a,r,e)},e}(n.n(_).a),w=["link","className"];function D(t,e){void 0===e&&(e={});var n=e,o=n.link,s=n.className,r=a(n,w);return r.className=f()("RecipientsLabel",s),m("span",r,null==t?void 0:t.map((function(t,e){var n=t instanceof u.a?"u":"g";return m(P,{key:n+"-"+e,recipient:t,link:o})})),!t&&m(P,null))}var O=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t),e.initAttrs=function(e){function n(t,e,n){return t.filter((function(t){return-1===e.indexOf(t)})).map((function(t){return app.store.getById(n,t)}))}t.initAttrs.call(this,e);var o=e.post.content();if(o.new||2!=o.length){var s=n(o.new.users,o.old.users,"users"),r=n(o.old.users,o.new.users,"users"),i=n(o.new.groups,o.old.groups,"groups"),a=n(o.old.groups,o.new.groups,"groups");e.added=s.concat(i),e.removed=r.concat(a)}else{var c=e.post.content()[0],u=e.post.content()[1];e.added=n(u,c,"users"),e.removed=n(c,u,"users")}};var n=e.prototype;return n.icon=function(){return app.forum.data.attributes["byobu.icon-postAction"]},n.descriptionKey=function(){var t="fof-byobu.forum.post.recipients_modified.";return this.attrs.added.length?this.attrs.removed.length?t+"added_and_removed":t+"added":t+"removed"},n.descriptionData=function(){var t={};return this.attrs.added.length&&(t.added=D(this.attrs.added,{link:!0})),this.attrs.removed.length&&(t.removed=D(this.attrs.removed,{link:!0})),t},e}(r.a),j=n(1),N=n(22),k=n.n(N),S=n(23),U=n.n(S),A=function(t){!function(t){Object(j.extend)(k.a.prototype,"privacyItems",(function(e){var n=this;e.add("byobu-block-dm",U.a.component({state:this.user.blocksPd(),onchange:function(t){n.blocksPdLoading=!0,n.user.save({blocksPd:t}).then((function(){n.blocksPdLoading=!1,m.redraw()}))},loading:this.blocksPdLoading},t.translator.trans("fof-byobu.forum.user.settings.block_pd")))}))}(t)};var I=n(5),C=n.n(I),M=n(14),L=n.n(M),G=n(7),B=n.n(G),E=n(6),T=n.n(E),q=n(24),V=n.n(q),F=n(25),K=n.n(F),W=n(12),z=n.n(W),H=n(26),J=n.n(H),Q=n(3),X=n.n(Q),Y=n(27),Z=n.n(Y),tt=n(28),et=n.n(tt),nt=n(29),ot=n.n(nt),st=n(30),rt=n.n(st),it=n(31),at=n.n(it);function ct(){return(ct=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}var ut=n(17),pt=n.n(ut),ft=n(32),lt=n.n(ft),dt=function(){function t(){}var e=t.prototype;return e.view=function(t){var e=this;if(!(t.length<3||this.loading)){if(app.cache.byobuResults||(app.cache.byobuResults=[]),this.query=t,app.cache.byobuResults[this.query])return[m("li",{className:"Dropdown-header"},app.translator.trans("core.forum.search.users_heading")),app.cache.byobuResults[this.query].map((function(t){var n=d()(t),o=[pt()(n.text,e.query)];return m("li",{className:"SearchResult","data-index":"users:"+t.id()},m("a",{"data-index":"users:"+t.id()},lt()(t),ct({},n,{text:void 0,children:o})))}))];this.loading=!0,app.cache.byobuResults[this.query]=[],app.store.find("users",{filter:{q:this.query+" allows-pd"},page:{limit:5}}).then(this.pushResults.bind(this))}},e.pushResults=function(t){var e=this;t.payload.data.map((function(t){var n=app.store.getById("users",t.id);app.cache.byobuResults[e.query].push(n)})),this.loading=!1,m.redraw()},t}(),mt=function(){function t(){}var e=t.prototype;return e.search=function(t){return app.store.find("groups",{filter:{q:t},page:{limit:5}})},e.view=function(t){t=t.toLowerCase();var e=app.store.all("groups").filter((function(e){return e.namePlural().toLowerCase().substr(0,t.length)===t}));return e.length?[m("li",{className:"Dropdown-header"},app.translator.trans("fof-byobu.forum.search.headings.groups")),e.map((function(e){var n=e.namePlural(),o=pt()(n,t);return m("li",{className:"SearchResult","data-index":"groups:"+e.id()},m("a",{"data-index":"groups:"+e.id()},m("span",{class:"groupName"},o)))}))]:""},t}(),bt=n(33),ht=n.n(bt),yt=n(34),vt=n.n(yt),gt=n(35),xt=n.n(gt),_t=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).inputUuid=void 0,e}Object(o.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.inputUuid=Math.random().toString(36).substring(2)},n.oncreate=function(e){var n=this;t.prototype.oncreate.call(this,e);var o=this;this.$(".Search-results").on("click",(function(t){var e=n.$(".SearchResult.active");o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),this.$(".Search-results").on("touchstart",(function(t){var e=n.$(t.target.parentNode);o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),$(".RecipientsInput").on("input",(function(){clearTimeout(n.typingTimer),n.doSearch=!1,n.typingTimer=setTimeout((function(){n.doSearch=!0,m.redraw()}),900)})).on("keydown",(function(){clearTimeout(n.typingTimer)})),t.prototype.oncreate.call(this,e)},n.view=function(){var t=this;void 0===this.state.getValue()&&this.state.setValue("");var e=this.state.getValue()&&this.state.getValue().length>=3;return this.sources||(this.sources=this.sourceItems().toArray()),m("div",{role:"search",className:"Search"},m("div",{className:"RecipientsInput-selected RecipientsLabel","aria-live":"polite"},m("h4",null,x.a.translator.trans("fof-byobu.forum.modal.labels.selected_users")),m("p",null,x.a.translator.trans("fof-byobu.forum.modal.help.selected_users")),this.attrs.selected().toArray().map((function(e){return m(xt.a,{text:x.a.translator.trans("fof-byobu.forum.modal.help.click_user_to_remove_tooltip")},m(P,{"data-container":"body",recipient:e,onclick:function(n){return t.removeRecipient(e,n)}}))}))),m("div",{className:"Form-group"},m("label",{for:"byobu-addrecipient-search-input-"+this.inputUuid},x.a.translator.trans("fof-byobu.forum.modal.labels.search_field")),m("div",{className:"AddRecipientModal-form-input Search-input"},m("input",{id:"byobu-addrecipient-search-input-"+this.inputUuid,className:f()("RecipientsInput","FormControl",{open:!!this.state.getValue(),focused:!!this.state.getValue(),active:!!this.state.getValue(),loading:!!this.loadingSources}),oncreate:function(t){return t.dom.focus()},type:"search",placeholder:ht()(x.a.translator.trans("fof-byobu.forum.input.search_recipients")),value:this.state.getValue(),oninput:function(e){return t.state.setValue(e.target.value)},onfocus:function(){return t.hasFocus=!0},onblur:function(){return t.hasFocus=!1}}),m("ul",{className:f()("Dropdown-menu","Search-results","fade",{in:!!e})},this.doSearch?this.sources.map((function(e){return e.view(t.state.getValue())})):vt.a.component({size:"tiny",className:"Button Button--icon Button--link"})))))},n.sourceItems=function(){var t=new X.a;return(!this.attrs.discussion&&x.a.forum.attribute("canStartPrivateDiscussionWithUsers")||this.attrs.discussion&&this.attrs.discussion.canEditUserRecipients())&&t.add("users",new dt),(!this.attrs.discussion&&x.a.forum.attribute("canStartPrivateDiscussionWithGroups")||this.attrs.discussion&&this.attrs.discussion.canEditGroupRecipients())&&t.add("groups",new mt),t},n.addRecipient=function(t){var e=t.split(":"),n=e[0],o=e[1],s=this.findRecipient(n,o);this.attrs.selected().add(t,s),this.state.clear()},n.removeRecipient=function(t,e){var n;e.preventDefault(),t instanceof u.a&&(n="users"),t instanceof h.a&&(n="groups"),this.attrs.selected().remove(n+":"+t.id())},n.findRecipient=function(t,e){return x.a.store.getById(t,e)},e}(at.a),Rt=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.selected=ot()(new X.a),this.attrs.discussion?this.assignInitialRecipients(this.attrs.discussion):this.attrs.selectedRecipients&&this.attrs.selectedRecipients.toArray().length>0?this.selected().merge(this.attrs.selectedRecipients):this.selected().add("users:"+app.session.user.id(),app.session.user),this.recipientSearch=new rt.a},n.isDismissible=function(){return!1},n.assignInitialRecipients=function(t){var e=this;t.recipientUsers().map((function(t){e.selected().add("users:"+t.id(),t)})),t.recipientGroups().map((function(t){e.selected().add("groups:"+t.id(),t)}))},n.className=function(){return"AddRecipientModal"},n.title=function(){return this.attrs.discussion?app.translator.trans("fof-byobu.forum.modal.titles.update_recipients",{title:m("em",null,this.attrs.discussion.title())}):app.translator.trans("fof-byobu.forum.modal.titles.add_recipients")},n.helpText=function(){return this.attrs.discussion?app.translator.trans("fof-byobu.forum.modal.help.update_recipients"):app.translator.trans("fof-byobu.forum.modal.help.add_recipients")},n.content=function(){return[m("div",{className:"Modal-body"},m("div",{class:"AddRecipientModal-help"},this.helpText()),m("div",{className:"AddRecipientModal-form"},_t.component({state:this.recipientSearch,selected:this.selected,discussion:this.attrs.discussion}),m("div",{className:"AddRecipientModal-form-submit App-primaryControl"},T.a.component({type:"submit",className:"Button Button--primary",icon:"fas fa-check"},app.translator.trans("fof-byobu.forum.buttons.submit")),T.a.component({onclick:this.hide.bind(this),className:"Button Button--cancel"},app.translator.trans("fof-byobu.forum.buttons.cancel")))))]},n.select=function(t){(t.metaKey||t.ctrlKey||-1!==this.selected.indexOf(this.index))&&this.selected().length&&this.$("form").submit()},n.onsubmit=function(t){t.preventDefault();var e=this.attrs.discussion,n=this.selected(),o=[],s=[];n.toArray().forEach((function(t){t instanceof u.a&&s.push(t),t instanceof h.a&&o.push(t)})),e&&e.save({relationships:{recipientUsers:s,recipientGroups:o}}).then((function(){app.current instanceof et.a&&app.current.stream.update(),m.redraw()})),this.attrs.onsubmit&&this.attrs.onsubmit(n),app.modal.close(),this.attrs.discussion||app.composer.show(),t.redraw=!1},e}(Z.a),Pt=function(){B.a.prototype.recipientUsers=C.a.hasMany("recipientUsers"),B.a.prototype.oldRecipientUsers=C.a.hasMany("oldRecipientUsers"),B.a.prototype.recipientGroups=C.a.hasMany("recipientGroups"),B.a.prototype.oldRecipientGroups=C.a.hasMany("oldRecipientGroups"),B.a.prototype.canEditRecipients=C.a.attribute("canEditRecipients"),B.a.prototype.canEditUserRecipients=C.a.attribute("canEditUserRecipients"),B.a.prototype.canEditGroupRecipients=C.a.attribute("canEditGroupRecipients"),B.a.prototype.canEditGroupRecipients=C.a.attribute("canEditGroupRecipients"),B.a.prototype.isPrivateDiscussion=C.a.attribute("isPrivateDiscussion"),Object(j.extend)(B.a.prototype,"badges",(function(t){(this.recipientUsers().length||this.recipientGroups().length)&&t.add("private",L.a.component({type:"private",label:app.translator.trans("fof-byobu.forum.badges.is_private.tooltip"),icon:app.forum.data.attributes["byobu.icon-badge"]}),10)})),Object(j.extend)(V.a.prototype,"infoItems",(function(t){var e=this.attrs.discussion;wt(e,t,!0)})),Object(j.extend)(K.a.prototype,"items",(function(t){var e=this.attrs.discussion;wt(e,t,!1)})),Object(j.extend)(z.a.prototype,"requestParams",(function(t){t.include.push("recipientUsers"),t.include.push("recipientGroups")})),Object(j.extend)(J.a,"moderationControls",(function(t,e){e.canEditRecipients()&&t.add("recipients",T.a.component({icon:app.forum.data.attributes["byobu.icon-badge"],onclick:function(){return app.modal.show(Rt,{discussion:e})}},app.translator.trans("fof-byobu.forum.buttons.edit_recipients"))),e&&e.recipientUsers().find((function(t){return t.id()===app.session.user.id()}))&&t.add("remove",T.a.component({icon:"fas fa-user-slash",onclick:function(){if(e){var t=new X.a;e.recipientUsers().map((function(e){app.session.user.id()!==e.id()&&t.add("users:"+e.id(),e)}));var n=[],o=[];t.toArray().forEach((function(t){t instanceof u.a&&o.push(t),t instanceof h.a&&n.push(t)})),e.save({relationships:{recipientUsers:o,recipientGroups:n}}).then((function(){return app.history.back()}))}}},app.translator.trans("fof-byobu.forum.buttons.remove_from_discussion")))}))},wt=function(t,e,n){var o=[];t.recipientUsers().length&&(o=o.concat(t.recipientUsers())),t.recipientGroups().length&&(o=o.concat(t.recipientGroups())),o&&o.length&&(n?e.add("recipients",D(o),10):e.add("recipients",D(o,{link:!0}),4))};var Dt=n(36),Ot=n.n(Dt),jt=n(37);var Nt=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this)._isByobuComposer=!0,e}Object(o.a)(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e),e.titlePlaceholder=app.translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),e.submitLabel=app.translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")};var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.composer.fields.recipients=this.attrs.recipients||new X.a,this.composer.fields.recipientUsers=this.attrs.recipientUsers||[],this.composer.fields.recipientGroups=this.attrs.recipientGroups||[];var n=m.route.param("username");void 0!==n&&this.addDefaultRecipients(n)},n.data=function(){var e=t.prototype.data.call(this),n=[],o=[];return void 0!==this.composer.fields.recipients&&this.composer.fields.recipients.toArray().forEach((function(t){t instanceof u.a&&n.push(t),t instanceof h.a&&o.push(t)})),e.relationships=e.relationships||{},n.length&&(e.relationships.recipientUsers=n),o.length&&(e.relationships.recipientGroups=o),delete e.relationships.tags,e},n.chooseRecipients=function(){var t=this;app.modal.show(Rt,{selectedRecipients:this.composer.fields.recipients,onsubmit:function(e){t.composer.fields.recipients=e,t.$(".RecipientsInput").focus()}})},n.headerItems=function(){var e=t.prototype.headerItems.call(this);if(e.remove("tags"),app.session.user&&app.forum.attribute("canStartPrivateDiscussion")){var n=this.composer.fields.recipients.toArray();e.add("recipients",m("a",{className:"PrivateDiscussionComposer-changeRecipients",onclick:this.chooseRecipients.bind(this)},n.length?function(t,e){void 0===e&&(e={}),e.style=e.style||{},e.className="RecipientLabel "+(e.className||"");var n=app.translator.trans("fof-byobu.forum.labels.recipients",{count:t});return m("span",e,m("span",{className:"RecipientLabel-text"},n))}(n.length):m("span",{className:"RecipientLabel none"},app.translator.trans("fof-byobu.forum.buttons.add_recipients"))),5)}return e},n.addDefaultRecipients=function(t){var e=app.store.getBy("users","username",t);this.composer.fields.recipients.add("users:"+app.session.user.id(),app.session.user),e.id()!==app.session.user.id()&&this.composer.fields.recipients.add("users:"+e.id(),e)},n.onsubmit=function(){if(this.loading=!0,this.composer.fields.recipients.toArray().length<2)this.chooseRecipients(),this.loading=!1;else{var t=this.data();app.store.createRecord("discussions").save(t).then((function(t){app.cache.discussionList&&app.cache.discussionList.refresh(),m.route.set(app.route.discussion(t)),app.composer.hide()}),this.loaded.bind(this))}},e}(n.n(jt).a),kt=n(18),St=n.n(kt),Ut=function(t){u.a.prototype.blocksPd=C.a.attribute("blocksPd"),u.a.prototype.cannotBeDirectMessaged=C.a.attribute("cannotBeDirectMessaged"),u.a.prototype.unreadPrivateMessagesCount=C.a.attribute("unreadPrivateMessagesCount"),function(t){Object(j.extend)(Ot.a,"userControls",(function(e,n){return t.session.user&&t.session.user.id()!==n.id()&&t.forum.attribute("canStartPrivateDiscussion")&&(!1===n.blocksPd()||t.forum.attribute("canStartPrivateDiscussionWithBlockers")&&n.cannotBeDirectMessaged())&&e.add("private-discussion",T.a.component({icon:t.forum.data.attributes["byobu.icon-badge"],onclick:function(e){return e.preventDefault(),new Promise((function(e){var o=new X.a;return o.add("users:"+t.session.user.id(),t.session.user),o.add("users:"+n.id(),n),Nt.prototype.recipients=o,t.composer.load(Nt,{user:t.session.user,recipients:o,recipientUsers:o,titlePlaceholder:t.translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),submitLabel:t.translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")}),t.composer.show(),e(t.composer)}))}},t.translator.trans("fof-byobu.forum.buttons.send_pd",{username:n.username()}))),e}))}(t),function(t){Object(j.extend)(St.a.prototype,"navItems",(function(e){var n=t.route("byobuUserPrivate",{username:this.user.slug()});(t.session.user||m.route.get()===n)&&t.session.user!==this.user&&e.add("byobu",v.a.component({href:n,icon:t.forum.data.attributes["byobu.icon-badge"]},t.translator.trans("fof-byobu.forum.user.byobu_link")),85)}))}(t)};var At=n(13),It=n.n(At),Ct=function(t){function e(){return t.apply(this,arguments)||this}return Object(o.a)(e,t),e}(z.a),Mt=n(38),Lt=n.n(Mt),Gt=n(20),Bt=n.n(Gt),Et=n(39),Tt=function(t){function e(){return t.apply(this,arguments)||this}return Object(o.a)(e,t),e}(n.n(Et).a);function qt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Vt=n(40),$t=n.n(Vt),Ft=function(){function t(t){this.recipient=t}var e,n,o,s=t.prototype;return s.action=function(t){var e=this;return t.preventDefault(),new Promise((function(t,n){if(app.session.user){var o=new X.a;return o.add("users:"+app.session.user.id(),app.session.user),e.recipient&&app.session.user.id()!==e.recipient.id()&&o.add("users:"+e.recipient.id(),e.recipient),app.composer.load(Nt,{user:app.session.user,recipients:o,recipientUsers:o}),app.composer.show(),t()}return app.modal.show($t.a),n()}))},s.component=function(){return T.a.component({icon:"fas fa-pen",className:"Button Button--primary IndexPage-newDiscussion",itemClassName:"App-primaryControl fof-byobu_primaryControl",onclick:this.action.bind(this),disabled:!this.canStartDiscussion},app.translator.trans(this.canStartDiscussion?"fof-byobu.forum.nav.start_button":"core.forum.index.cannot_start_discussion_button"))},e=t,(n=[{key:"canStartDiscussion",get:function(){return app.session.user&&app.forum.attribute("canStartPrivateDiscussion")}}])&&qt(e.prototype,n),o&&qt(e,o),t}(),Kt=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.changeSort("latest")},n.show=function(e){this.list=new Ct({q:"byobu:"+e.slug()+" is:private",sort:this.sort}),this.list.refresh(),t.prototype.show.call(this,e)},n.handleChangeSort=function(t,e){e.preventDefault(),this.changeSort(t)},n.changeSort=function(t){this.sort=t,this.loadUser(m.route.param("username"))},n.content=function(){return m("div",{className:"DiscussionsUserPage"},m("div",{className:"DiscussionsUserPage-toolbar"},m("ul",{className:"DiscussionsUserPage-toolbar-action"},Bt()(this.actionItems().toArray())),m("ul",{className:"DiscussionsUserPage-toolbar-view"},Bt()(this.viewItems().toArray()))),m(Tt,{state:this.list}))},n.actionItems=function(){var t=new Ft(this.user),e=new X.a;return app.session.user&&app.forum.attribute("canStartPrivateDiscussion")&&e.add("start_private",t.component()),e},n.viewItems=function(){var t=this,e=new X.a,n=this.list.sortMap(),o={};for(var s in n)o[s]=app.translator.trans("core.forum.index_sort."+s+"_button");return e.add("sort",Lt.a.component({buttonClassName:"Button",label:o[this.sort]||Object.keys(n).map((function(t){return o[t]}))[0]},Object.keys(o).map((function(e){var s=o[e],r=(t.sort||Object.keys(n)[0])===e;return T.a.component({icon:!r||"fas fa-check",onclick:t.handleChangeSort.bind(t,e),active:r},s)})))),e},e}(St.a),Wt=function(t){!function(t){t.routes.byobuUserPrivate={path:"/u/:username/private",component:Kt},t.routes.byobuPrivate={path:"/private",component:It.a}}(t),function(t){Object(j.extend)(It.a.prototype,"navItems",(function(e){t.session.user&&e.add("privateDiscussions",v.a.component({icon:t.forum.data.attributes["byobu.icon-badge"],href:t.route("byobuPrivate")},t.translator.trans("fof-byobu.forum.nav.nav_item")),75)})),Object(j.extend)(It.a.prototype,"setTitle",(function(){"byobuPrivate"===t.current.get("routeName")&&t.setTitle(t.translator.trans("fof-byobu.forum.user.dropdown_label"))})),Object(j.extend)(z.a.prototype,"requestParams",(function(e){"byobuPrivate"===t.current.get("routeName")&&(e.filter.q=(e.filter.q||"")+" is:private",e.include.push("recipientUsers"),e.include.push("recipientGroups"))})),Object(j.extend)(It.a.prototype,"sidebarItems",(function(e){if("byobuPrivate"===t.current.get("routeName")){var n=new Ft;e.replace("newDiscussion",n.component())}}))}(t)},zt=n(41),Ht=n.n(zt),Jt=n(9),Qt=n.n(Jt),Xt=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.icon=function(){return app.forum.data.attributes["byobu.icon-badge"]},n.href=function(){var t=this.attrs.notification.subject();return app.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return app.translator.trans("fof-byobu.forum.notifications.pd_text",{user:t})},e}(Qt.a),Yt=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.icon=function(){return"fas fa-reply"},n.href=function(){var t=this.attrs.notification,e=t.subject(),n=t.content()||{};return app.route.discussion(e,n.postNumber)},n.content=function(){var t=this.attrs.notification.fromUser();return app.translator.trans("fof-byobu.forum.notifications.pd_reply_text",{user:t})},e}(Qt.a),Zt=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.icon=function(){return app.forum.data.attributes["byobu.icon-badge"]},n.href=function(){var t=this.attrs.notification.subject();return app.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return app.translator.trans("fof-byobu.forum.notifications.pd_user_left_text",{user:t})},e}(Qt.a),te=function(t){function e(){return t.apply(this,arguments)||this}Object(o.a)(e,t);var n=e.prototype;return n.icon=function(){return app.forum.data.attributes["byobu.icon-badge"]},n.href=function(){var t=this.attrs.notification.subject();return app.route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return app.translator.trans("fof-byobu.forum.notifications.pd_added_text",{user:t})},e}(Qt.a);function ee(){Object(j.extend)(Ht.a.prototype,"notificationTypes",(function(t){t.add("byobuPrivateDiscussionCreated",{name:"byobuPrivateDiscussionCreated",icon:app.forum.data.attributes["byobu.icon-badge"],label:app.translator.trans("fof-byobu.forum.notifications.pd_label")}),t.add("byobuPrivateDiscussionReplied",{name:"byobuPrivateDiscussionReplied",icon:app.forum.data.attributes["byobu.icon-badge"],label:app.translator.trans("fof-byobu.forum.notifications.pd_reply_label")}),t.add("byobuPrivateDiscussionAdded",{name:"byobuPrivateDiscussionAdded",icon:app.forum.data.attributes["byobu.icon-badge"],label:app.translator.trans("fof-byobu.forum.notifications.pd_added_label")}),t.add("byobuRecipientRemoved",{name:"byobuRecipientRemoved",icon:app.forum.data.attributes["byobu.icon-badge"],label:app.translator.trans("fof-byobu.forum.notifications.pd_user_left_label")})}))}var ne={AddRecipientModal:Rt},oe={PrivateDiscussionComposer:Nt,PrivateDiscussionList:Tt};app.initializers.add("fof-byobu",(function(t){!function(t){t.postComponents.recipientsModified=O,t.postComponents.recipientLeft=i}(t),function(t){Pt(),A(t),Ut(t)}(t),Wt(t),function(t){t.notificationComponents.byobuPrivateDiscussionCreated=Xt,t.notificationComponents.byobuPrivateDiscussionReplied=Yt,t.notificationComponents.byobuRecipientRemoved=Zt,t.notificationComponents.byobuPrivateDiscussionAdded=te,ee()}(t)}))}]);
//# sourceMappingURL=forum.js.map