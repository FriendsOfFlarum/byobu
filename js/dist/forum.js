(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{discussions:()=>ie,modals:()=>re});const n=flarum.core.compat["forum/app"];var o=t.n(n);function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}const i=flarum.core.compat["forum/components/EventPost"];var a=t.n(i),c=function(t){function e(){return t.apply(this,arguments)||this}r(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e)};var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){return"fof-byobu.forum.post.recipients_modified.made_public"},e}(a()),u=function(t){function e(){return t.apply(this,arguments)||this}r(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e)};var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){return"fof-byobu.forum.post.recipients_modified.removed_self"},e}(a());function p(t,e){if(null==t)return{};var n,o,s={},r=Object.keys(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||(s[n]=t[n]);return s}const l=flarum.core.compat["common/models/User"];var f=t.n(l);const d=flarum.core.compat["common/utils/classList"];var h=t.n(d);const b=flarum.core.compat["common/helpers/username"];var v=t.n(b);const y=flarum.core.compat["common/models/Group"];var g=t.n(y);const _=flarum.core.compat["common/components/LinkButton"];var P=t.n(_);const R=flarum.core.compat["common/Component"];var w=["recipient","link"],D=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.view=function(t){var e,n=this.attrs,s=n.recipient,r=n.link,i=p(n,w);if(i.style=i.style||{},i.className=h()("RecipientLabel",null==i?void 0:i.className),r&&s instanceof f()&&(i.href=o().route.user(s)),s instanceof f()){var a,c;e=v()(s),i.href||s.id()===(null==o()||null==(a=o().session)||null==(c=a.user)?void 0:c.id())||(i.href=o().route.user(s))}else{if(s instanceof g())return m("span",{class:i.className},s.namePlural());i.className+=" none",e=o().translator.trans("core.lib.username.deleted_text")}return m(P(),i,e)},e}(t.n(R)()),S=["link","className"];function k(t,e){void 0===e&&(e={});var n=e,o=n.link,s=n.className,r=p(n,S);return r.className=h()("RecipientsLabel",s),m("span",r,null==t?void 0:t.map((function(t,e){var n=t instanceof f()?"u":"g";return m(D,{key:n+"-"+e,recipient:t,link:o})})),!t&&m(D,null))}var x=function(t){function e(){return t.apply(this,arguments)||this}r(e,t),e.initAttrs=function(e){function n(t,e,n){return t.filter((function(t){return-1===e.indexOf(t)})).map((function(t){return o().store.getById(n,t)}))}t.initAttrs.call(this,e);var s=e.post.content();if(s.new||2!=s.length){var r=n(s.new.users,s.old.users,"users"),i=n(s.old.users,s.new.users,"users"),a=n(s.new.groups,s.old.groups,"groups"),c=n(s.old.groups,s.new.groups,"groups");e.added=r.concat(a),e.removed=i.concat(c)}else{var u=e.post.content()[0],p=e.post.content()[1];e.added=n(p,u,"users"),e.removed=n(u,p,"users")}};var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-postAction")},n.descriptionKey=function(){var t="fof-byobu.forum.post.recipients_modified.";return this.attrs.added.length?this.attrs.removed.length?t+"added_and_removed":t+"added":t+"removed"},n.descriptionData=function(){var t={};return this.attrs.added.length&&(t.added=k(this.attrs.added,{link:!0})),this.attrs.removed.length&&(t.removed=k(this.attrs.removed,{link:!0})),t},e}(a());const N=flarum.core.compat["common/extend"],U=flarum.core.compat["forum/components/SettingsPage"];var A=t.n(U);const C=flarum.core.compat["common/components/Switch"];var I=t.n(C);const M=flarum.core.compat["common/Model"];var G=t.n(M);const L=flarum.core.compat["common/components/Badge"];var B=t.n(L);const j=flarum.core.compat["common/models/Discussion"];var O=t.n(j);const T=flarum.core.compat["common/components/Button"];var E=t.n(T);const q=flarum.core.compat["forum/components/DiscussionListItem"];var V=t.n(q);const K=flarum.core.compat["forum/components/DiscussionHero"];var F=t.n(K);const W=flarum.core.compat["forum/states/DiscussionListState"];var z=t.n(W);const H=flarum.core.compat["forum/utils/DiscussionControls"];var J=t.n(H);const Q=flarum.core.compat["common/utils/ItemList"];var X=t.n(Q);const Y=flarum.core.compat["common/components/Modal"];var Z=t.n(Y);const tt=flarum.core.compat["forum/components/DiscussionPage"];var et=t.n(tt);const nt=flarum.core.compat["common/utils/Stream"];var ot=t.n(nt);const st=flarum.core.compat["forum/states/SearchState"];var rt=t.n(st);const it=flarum.core.compat["forum/components/Search"];var at=t.n(it);function ct(){return ct=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},ct.apply(this,arguments)}const ut=flarum.core.compat["common/helpers/highlight"];var pt=t.n(ut);const lt=flarum.core.compat["common/helpers/avatar"];var ft=t.n(lt),mt=function(){function t(){}var e=t.prototype;return e.view=function(t){var e=this;if(!(t.length<3||this.loading)){if(o().cache.byobuResults||(o().cache.byobuResults=[]),this.query=t,o().cache.byobuResults[this.query])return[m("li",{className:"Dropdown-header"},o().translator.trans("core.forum.search.users_heading")),o().cache.byobuResults[this.query].map((function(t){var n=v()(t),o=[pt()(n.text,e.query)];return m("li",{className:"SearchResult","data-index":"users:"+t.id()},m("a",{"data-index":"users:"+t.id()},ft()(t),ct({},n,{text:void 0,children:o})))}))];this.loading=!0,o().cache.byobuResults[this.query]=[],o().store.find("users",{filter:{q:this.query+" allows-pd"},page:{limit:5}}).then(this.pushResults.bind(this))}},e.pushResults=function(t){var e=this;t.payload.data.map((function(t){var n=o().store.getById("users",t.id);o().cache.byobuResults[e.query].push(n)})),this.loading=!1,m.redraw()},t}(),dt=function(){function t(){}var e=t.prototype;return e.search=function(t){return o().store.find("groups",{filter:{q:t},page:{limit:5}})},e.view=function(t){t=t.toLowerCase();var e=o().store.all("groups").filter((function(e){return e.namePlural().toLowerCase().substr(0,t.length)===t}));return e.length?[m("li",{className:"Dropdown-header"},o().translator.trans("fof-byobu.forum.search.headings.groups")),e.map((function(e){var n=e.namePlural(),o=pt()(n,t);return m("li",{className:"SearchResult","data-index":"groups:"+e.id()},m("a",{"data-index":"groups:"+e.id()},m("span",{class:"groupName"},o)))}))]:""},t}();const ht=flarum.core.compat["common/utils/extractText"];var bt=t.n(ht);const vt=flarum.core.compat["common/components/LoadingIndicator"];var yt=t.n(vt);const gt=flarum.core.compat["common/components/Tooltip"];var _t=t.n(gt),Pt=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).inputUuid=void 0,e}r(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.inputUuid=Math.random().toString(36).substring(2)},n.oncreate=function(e){var n=this;t.prototype.oncreate.call(this,e);var o=this;this.$(".Search-results").on("click",(function(t){var e=n.$(".SearchResult.active");o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),this.$(".Search-results").on("touchstart",(function(t){var e=n.$(t.target.parentNode);o.addRecipient(e.data("index")),o.$(".RecipientsInput").focus()})),$(".RecipientsInput").on("input",(function(){clearTimeout(n.typingTimer),n.doSearch=!1,n.typingTimer=setTimeout((function(){n.doSearch=!0,m.redraw()}),900)})).on("keydown",(function(){clearTimeout(n.typingTimer)})),t.prototype.oncreate.call(this,e)},n.view=function(){var t=this;void 0===this.searchState.getValue()&&this.searchState.setValue("");var e=this.searchState.getValue()&&this.searchState.getValue().length>=3;return this.sources||(this.sources=this.sourceItems().toArray()),m("div",{role:"search",className:"Search"},m("div",{className:"RecipientsInput-selected RecipientsLabel","aria-live":"polite"},m("h4",null,o().translator.trans("fof-byobu.forum.modal.labels.selected_users")),m("p",null,o().translator.trans("fof-byobu.forum.modal.help.selected_users")),this.attrs.selected().toArray().map((function(e){return m(_t(),{text:o().translator.trans("fof-byobu.forum.modal.help.click_user_to_remove_tooltip")},m(D,{"data-container":"body",recipient:e,onclick:function(n){return t.removeRecipient(e,n)}}))}))),m("div",{className:"Form-group"},m("label",{for:"byobu-addrecipient-search-input-"+this.inputUuid},o().translator.trans("fof-byobu.forum.modal.labels.search_field")),m("div",{className:"AddRecipientModal-form-input Search-input"},m("input",{id:"byobu-addrecipient-search-input-"+this.inputUuid,className:h()("RecipientsInput","FormControl",{open:!!this.searchState.getValue(),focused:!!this.searchState.getValue(),active:!!this.searchState.getValue(),loading:!!this.loadingSources}),oncreate:function(t){return t.dom.focus()},type:"search",placeholder:bt()(o().translator.trans("fof-byobu.forum.input.search_recipients")),value:this.searchState.getValue(),oninput:function(e){return t.searchState.setValue(e.target.value)},onfocus:function(){return t.hasFocus=!0},onblur:function(){return t.hasFocus=!1}}),m("ul",{className:h()("Dropdown-menu","Search-results","fade",{in:!!e})},this.doSearch?this.sources.map((function(e){return e.view(t.searchState.getValue())})):yt().component({size:"tiny",className:"Button Button--icon Button--link"})))))},n.sourceItems=function(){var t=new(X());return(!this.attrs.discussion&&o().forum.attribute("canStartPrivateDiscussionWithUsers")||this.attrs.discussion&&this.attrs.discussion.canEditUserRecipients())&&t.add("users",new mt),(!this.attrs.discussion&&o().forum.attribute("canStartPrivateDiscussionWithGroups")||this.attrs.discussion&&this.attrs.discussion.canEditGroupRecipients())&&t.add("groups",new dt),t},n.addRecipient=function(t){var e=t.split(":"),n=e[0],o=e[1],s=this.findRecipient(n,o);this.attrs.selected().add(t,s),this.searchState.clear()},n.removeRecipient=function(t,e){var n;e.preventDefault(),t instanceof f()&&(n="users"),t instanceof g()&&(n="groups"),this.attrs.selected().remove(n+":"+t.id())},n.findRecipient=function(t,e){return o().store.getById(t,e)},e}(at()),Rt=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.selected=ot()(new(X())),this.attrs.discussion?this.assignInitialRecipients(this.attrs.discussion):this.attrs.selectedRecipients&&this.attrs.selectedRecipients.toArray().length>0?this.selected().merge(this.attrs.selectedRecipients):this.selected().add("users:"+o().session.user.id(),o().session.user),this.recipientSearch=new(rt())},n.isDismissible=function(){return!1},n.assignInitialRecipients=function(t){var e=this;t.recipientUsers().map((function(t){e.selected().add("users:"+t.id(),t)})),t.recipientGroups().map((function(t){e.selected().add("groups:"+t.id(),t)}))},n.className=function(){return"AddRecipientModal"},n.title=function(){return this.attrs.discussion?o().translator.trans("fof-byobu.forum.modal.titles.update_recipients",{title:m("em",null,this.attrs.discussion.title())}):o().translator.trans("fof-byobu.forum.modal.titles.add_recipients")},n.helpText=function(){return this.attrs.discussion?o().translator.trans("fof-byobu.forum.modal.help.update_recipients"):o().translator.trans("fof-byobu.forum.modal.help.add_recipients")},n.content=function(){return[m("div",{className:"Modal-body"},m("div",{class:"AddRecipientModal-help"},this.helpText()),m("div",{className:"AddRecipientModal-form"},Pt.component({state:this.recipientSearch,selected:this.selected,discussion:this.attrs.discussion}),m("div",{className:"AddRecipientModal-form-submit App-primaryControl"},E().component({type:"submit",className:"Button Button--primary",icon:"fas fa-check"},o().translator.trans("fof-byobu.forum.buttons.submit")),E().component({onclick:this.hide.bind(this),className:"Button Button--cancel"},o().translator.trans("fof-byobu.forum.buttons.cancel")))))]},n.select=function(t){(t.metaKey||t.ctrlKey||-1!==this.selected.indexOf(this.index))&&this.selected().length&&this.$("form").submit()},n.onsubmit=function(t){t.preventDefault();var e=this.attrs.discussion,n=this.selected(),s=[],r=[];n.toArray().forEach((function(t){t instanceof f()&&r.push(t),t instanceof g()&&s.push(t)})),e&&e.save({relationships:{recipientUsers:r,recipientGroups:s}}).then((function(){o().current instanceof et()&&o().current.stream.update(),m.redraw()})),this.attrs.onsubmit&&this.attrs.onsubmit(n),o().modal.close(),this.attrs.discussion||o().composer.show(),t.redraw=!1},e}(Z());const wt=flarum.core.compat["tags/components/TagDiscussionModal"];var Dt=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.onsubmit=function(t){t.preventDefault();var e=this.selected;this.attrs.resolve&&this.attrs.resolve(e),this.hide()},e}(t.n(wt)());Dt.isDismissible=!1;const St=flarum.core.compat["components/DiscussionPage"];var kt=t.n(St);var xt=function(t,e,n){var o=[];t.recipientUsers().length&&(o=o.concat(t.recipientUsers())),t.recipientGroups().length&&(o=o.concat(t.recipientGroups())),o&&o.length&&(n?e.add("recipients",k(o),10):e.add("recipients",k(o,{link:!0}),4))};const Nt=flarum.core.compat["forum/utils/UserControls"];var Ut=t.n(Nt);const At=flarum.core.compat["forum/components/DiscussionComposer"];var Ct=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this)._isByobuComposer=!0,e}r(e,t),e.initAttrs=function(e){t.initAttrs.call(this,e),e.titlePlaceholder=o().translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),e.submitLabel=o().translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")};var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.composer.fields.recipients=this.attrs.recipients||new(X()),this.composer.fields.recipientUsers=this.attrs.recipientUsers||[],this.composer.fields.recipientGroups=this.attrs.recipientGroups||[];var n=m.route.param("username");void 0!==n&&this.addDefaultRecipients(n)},n.data=function(){var e=t.prototype.data.call(this),n=[],o=[];return void 0!==this.composer.fields.recipients&&this.composer.fields.recipients.toArray().forEach((function(t){t instanceof f()&&n.push(t),t instanceof g()&&o.push(t)})),e.relationships=e.relationships||{},n.length&&(e.relationships.recipientUsers=n),o.length&&(e.relationships.recipientGroups=o),delete e.relationships.tags,e},n.chooseRecipients=function(){var t=this;o().modal.show(Rt,{selectedRecipients:this.composer.fields.recipients,onsubmit:function(e){t.composer.fields.recipients=e,t.$(".RecipientsInput").focus()}})},n.headerItems=function(){var e=t.prototype.headerItems.call(this);if(e.remove("tags"),o().session.user&&o().forum.attribute("canStartPrivateDiscussion")){var n=this.composer.fields.recipients.toArray();e.add("recipients",m("a",{className:"PrivateDiscussionComposer-changeRecipients",onclick:this.chooseRecipients.bind(this)},n.length?function(t,e){void 0===e&&(e={}),e.style=e.style||{},e.className="RecipientLabel "+(e.className||"");var n=o().translator.trans("fof-byobu.forum.labels.recipients",{count:t});return m("span",e,m("span",{className:"RecipientLabel-text"},n))}(n.length):m("span",{className:"RecipientLabel none"},o().translator.trans("fof-byobu.forum.buttons.add_recipients"))),5)}return e},n.addDefaultRecipients=function(t){var e=o().store.getBy("users","username",t);this.composer.fields.recipients.add("users:"+o().session.user.id(),o().session.user),e.id()!==o().session.user.id()&&this.composer.fields.recipients.add("users:"+e.id(),e)},n.onsubmit=function(){if(this.loading=!0,this.composer.fields.recipients.toArray().length<2)this.chooseRecipients(),this.loading=!1;else{var t=this.data();o().store.createRecord("discussions").save(t).then((function(t){o().cache.discussionList&&o().cache.discussionList.refresh(),m.route.set(o().route.discussion(t)),o().composer.hide()}),this.loaded.bind(this))}},e}(t.n(At)());const It=flarum.core.compat["forum/components/UserPage"];var Mt=t.n(It);function Gt(t){return o().session.user&&o().session.user.id()!==t.id()&&o().forum.attribute("canStartPrivateDiscussion")&&(!t.blocksPd()||o().forum.attribute("canStartPrivateDiscussionWithBlockers")&&t.cannotBeDirectMessaged())}const Lt=flarum.core.compat["forum/components/IndexPage"];var Bt=t.n(Lt),jt=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(z());const Ot=flarum.core.compat["common/components/Dropdown"];var Tt=t.n(Ot);const Et=flarum.core.compat["common/helpers/listItems"];var qt=t.n(Et);const Vt=flarum.core.compat["forum/components/DiscussionList"];var $t=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(t.n(Vt)());function Kt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const Ft=flarum.core.compat["forum/components/LogInModal"];var Wt=t.n(Ft),zt=function(){function t(t){this.recipient=t}var e,n,s=t.prototype;return s.action=function(t){var e=this;return t.preventDefault(),new Promise((function(t,n){if(o().session.user){var s=new(X());return s.add("users:"+o().session.user.id(),o().session.user),e.recipient&&o().session.user.id()!==e.recipient.id()&&s.add("users:"+e.recipient.id(),e.recipient),o().composer.load(Ct,{user:o().session.user,recipients:s,recipientUsers:s}),o().composer.show(),t()}return o().modal.show(Wt()),n()}))},s.component=function(){return E().component({icon:"fas fa-pen",className:"Button Button--primary IndexPage-newDiscussion",itemClassName:"App-primaryControl fof-byobu_primaryControl",onclick:this.action.bind(this),disabled:!this.canStartDiscussion},o().translator.trans(this.canStartDiscussion?"fof-byobu.forum.nav.start_button":"core.forum.index.cannot_start_discussion_button"))},e=t,(n=[{key:"canStartDiscussion",get:function(){return o().session.user&&o().forum.attribute("canStartPrivateDiscussion")}}])&&Kt(e.prototype,n),t}(),Ht=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.changeSort("latest")},n.show=function(e){this.list=new jt({q:"byobu:"+e.slug()+" is:private",sort:this.sort}),this.list.refresh(),t.prototype.show.call(this,e)},n.handleChangeSort=function(t,e){e.preventDefault(),this.changeSort(t)},n.changeSort=function(t){this.sort=t,this.loadUser(m.route.param("username"))},n.content=function(){return m("div",{className:"DiscussionsUserPage"},m("div",{className:"DiscussionsUserPage-toolbar"},m("ul",{className:"DiscussionsUserPage-toolbar-action"},qt()(this.actionItems().toArray())),m("ul",{className:"DiscussionsUserPage-toolbar-view"},qt()(this.viewItems().toArray()))),m($t,{state:this.list}))},n.actionItems=function(){var t=new zt(this.user),e=new(X());return Gt(this.user)&&e.add("start_private",t.component()),e},n.viewItems=function(){var t=this,e=new(X()),n=this.list.sortMap(),s={};for(var r in n)s[r]=o().translator.trans("core.forum.index_sort."+r+"_button");return e.add("sort",Tt().component({buttonClassName:"Button",label:s[this.sort]||Object.keys(n).map((function(t){return s[t]}))[0]},Object.keys(s).map((function(e){var o=s[e],r=(t.sort||Object.keys(n)[0])===e;return E().component({icon:!r||"fas fa-check",onclick:t.handleChangeSort.bind(t,e),active:r},o)})))),e},e}(Mt());const Jt=flarum.core.compat["forum/components/NotificationGrid"];var Qt=t.n(Jt);const Xt=flarum.core.compat["forum/components/Notification"];var Yt=t.n(Xt),Zt=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return o().route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return o().translator.trans("fof-byobu.forum.notifications.pd_text",{user:t})},n.excerpt=function(){return null},e}(Yt()),te=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.icon=function(){return"fas fa-reply"},n.href=function(){var t=this.attrs.notification,e=t.subject(),n=t.content()||{};return o().route.discussion(e,n.postNumber)},n.content=function(){var t=this.attrs.notification.fromUser();return o().translator.trans("fof-byobu.forum.notifications.pd_reply_text",{user:t})},n.excerpt=function(){return null},e}(Yt()),ee=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return o().route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return o().translator.trans("fof-byobu.forum.notifications.pd_user_left_text",{user:t})},n.excerpt=function(){return null},e}(Yt()),ne=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.attrs.notification.subject();return o().route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return o().translator.trans("fof-byobu.forum.notifications.pd_added_text",{user:t})},n.excerpt=function(){return null},e}(Yt());const oe=flarum.core.compat["components/Notification"];var se=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.icon=function(){return o().forum.attribute("byobu.icon-badge")},n.href=function(){var t=this.props.notification.subject();return o().route.discussion(t)},n.content=function(){var t=this.props.notification.fromUser();return o().translator.trans("fof-byobu.forum.notifications.pd_made_public_text",{user:t})},n.excerpt=function(){return null},e}(t.n(oe)());var re={AddRecipientModal:Rt},ie={PrivateDiscussionComposer:Ct,PrivateDiscussionList:$t};o().initializers.add("fof-byobu",(function(){o().postComponents.recipientsModified=x,o().postComponents.recipientLeft=u,o().postComponents.madePublic=c,O().prototype.recipientUsers=G().hasMany("recipientUsers"),O().prototype.oldRecipientUsers=G().hasMany("oldRecipientUsers"),O().prototype.recipientGroups=G().hasMany("recipientGroups"),O().prototype.oldRecipientGroups=G().hasMany("oldRecipientGroups"),O().prototype.canEditRecipients=G().attribute("canEditRecipients"),O().prototype.canEditUserRecipients=G().attribute("canEditUserRecipients"),O().prototype.canEditGroupRecipients=G().attribute("canEditGroupRecipients"),O().prototype.canEditGroupRecipients=G().attribute("canEditGroupRecipients"),O().prototype.canMakePublic=G().attribute("canMakePublic"),O().prototype.isPrivateDiscussion=G().attribute("isPrivateDiscussion"),(0,N.extend)(O().prototype,"badges",(function(t){(this.recipientUsers().length||this.recipientGroups().length)&&t.add("private",B().component({type:"private",label:o().translator.trans("fof-byobu.forum.badges.is_private.tooltip"),icon:o().forum.data.attributes["byobu.icon-badge"]}),10)})),(0,N.extend)(V().prototype,"infoItems",(function(t){var e=this.attrs.discussion;xt(e,t,!0)})),(0,N.extend)(F().prototype,"items",(function(t){var e=this.attrs.discussion;xt(e,t,!1)})),(0,N.extend)(z().prototype,"requestParams",(function(t){t.include.push("recipientUsers"),t.include.push("recipientGroups")})),(0,N.extend)(J(),"moderationControls",(function(t,e){e.canEditRecipients()&&t.add("recipients",E().component({icon:o().forum.data.attributes["byobu.icon-badge"],onclick:function(){return o().modal.show(Rt,{discussion:e})}},o().translator.trans("fof-byobu.forum.buttons.edit_recipients"))),e&&e.recipientUsers().find((function(t){return t.id()===o().session.user.id()}))&&(t.add("remove",E().component({icon:"fas fa-user-slash",onclick:function(){if(e){var t=new(X());e.recipientUsers().map((function(e){o().session.user.id()!==e.id()&&t.add("users:"+e.id(),e)}));var n=[],s=[];t.toArray().forEach((function(t){t instanceof f()&&s.push(t),t instanceof g()&&n.push(t)})),e.save({relationships:{recipientUsers:s,recipientGroups:n}}).then((function(){return o().history.back()}))}}},o().translator.trans("fof-byobu.forum.buttons.remove_from_discussion"))),null!=e&&null!=e.isPrivateDiscussion&&e.isPrivateDiscussion()&&null!=e&&null!=e.canMakePublic&&e.canMakePublic()&&t.add("transform-public",m(E(),{icon:"far fa-eye",onclick:function(){if(e&&confirm(o().translator.trans("fof-byobu.forum.confirm.make_public"))){var t=[],n=[];flarum.extensions["flarum-tags"]?new Promise((function(t,n){o().modal.show(Dt,{discussion:e,resolve:t,reject:n})})).then((function(s){e.save({relationships:{recipientUsers:n,recipientGroups:t},public:e.id()}).then((function(){e.save({relationships:{tags:s}}).then((function(){o().current.matches(kt())&&o().current.get("stream").update(),m.redraw()}))}))})):e.save({relationships:{recipientUsers:n,recipientGroups:t},public:e.id()}).then((function(){return m.redraw()}))}}},o().translator.trans("fof-byobu.forum.buttons.make_public"))))})),(0,N.extend)(A().prototype,"privacyItems",(function(t){var e=this;t.add("byobu-block-dm",I().component({state:this.user.blocksPd(),onchange:function(t){e.blocksPdLoading=!0,e.user.save({blocksPd:t}).then((function(){e.blocksPdLoading=!1,m.redraw()}))},loading:this.blocksPdLoading},o().translator.trans("fof-byobu.forum.user.settings.block_pd")))})),f().prototype.blocksPd=G().attribute("blocksPd"),f().prototype.cannotBeDirectMessaged=G().attribute("cannotBeDirectMessaged"),f().prototype.unreadPrivateMessagesCount=G().attribute("unreadPrivateMessagesCount"),(0,N.extend)(Ut(),"userControls",(function(t,e){return Gt(e)&&t.add("private-discussion",E().component({icon:o().forum.attribute("byobu.icon-badge"),onclick:function(t){return t.preventDefault(),new Promise((function(t){var n=new(X());return n.add("users:"+o().session.user.id(),o().session.user),n.add("users:"+e.id(),e),Ct.prototype.recipients=n,o().composer.load(Ct,{user:o().session.user,recipients:n,recipientUsers:n,titlePlaceholder:o().translator.trans("fof-byobu.forum.composer_private_discussion.title_placeholder"),submitLabel:o().translator.trans("fof-byobu.forum.composer_private_discussion.submit_button")}),o().composer.show(),t(o().composer)}))}},o().translator.trans("fof-byobu.forum.buttons.send_pd",{username:e.username()}))),t})),(0,N.extend)(Mt().prototype,"navItems",(function(t){var e=o().route("byobuUserPrivate",{username:this.user.slug()});(o().session.user||m.route.get()===e)&&o().session.user!==this.user&&t.add("byobu",P().component({href:e,icon:o().forum.attribute("byobu.icon-badge")},o().translator.trans("fof-byobu.forum.user.byobu_link")),85)})),o().routes.byobuUserPrivate={path:"/u/:username/private",component:Ht},o().routes.byobuPrivate={path:"/private",component:Bt()},(0,N.extend)(Bt().prototype,"navItems",(function(t){o().session.user&&t.add("privateDiscussions",P().component({icon:o().forum.data.attributes["byobu.icon-badge"],href:o().route("byobuPrivate")},o().translator.trans("fof-byobu.forum.nav.nav_item")),75)})),(0,N.extend)(Bt().prototype,"setTitle",(function(){"byobuPrivate"===o().current.get("routeName")&&o().setTitle(o().translator.trans("fof-byobu.forum.user.dropdown_label"))})),(0,N.extend)(z().prototype,"requestParams",(function(t){"byobuPrivate"===o().current.get("routeName")&&(t.filter.q=(t.filter.q||"")+" is:private",t.include.push("recipientUsers"),t.include.push("recipientGroups"))})),(0,N.extend)(Bt().prototype,"sidebarItems",(function(t){if("byobuPrivate"===o().current.get("routeName")){var e=new zt;t.replace("newDiscussion",e.component())}})),o().notificationComponents.byobuPrivateDiscussionCreated=Zt,o().notificationComponents.byobuPrivateDiscussionReplied=te,o().notificationComponents.byobuRecipientRemoved=ee,o().notificationComponents.byobuPrivateDiscussionAdded=ne,o().notificationComponents.byobuPrivateDiscussionMadePubic=se,(0,N.extend)(Qt().prototype,"notificationTypes",(function(t){t.add("byobuPrivateDiscussionCreated",{name:"byobuPrivateDiscussionCreated",icon:o().forum.data.attributes["byobu.icon-badge"],label:o().translator.trans("fof-byobu.forum.notifications.pd_label")}),t.add("byobuPrivateDiscussionReplied",{name:"byobuPrivateDiscussionReplied",icon:o().forum.data.attributes["byobu.icon-badge"],label:o().translator.trans("fof-byobu.forum.notifications.pd_reply_label")}),t.add("byobuPrivateDiscussionAdded",{name:"byobuPrivateDiscussionAdded",icon:o().forum.data.attributes["byobu.icon-badge"],label:o().translator.trans("fof-byobu.forum.notifications.pd_added_label")}),t.add("byobuRecipientRemoved",{name:"byobuRecipientRemoved",icon:o().forum.data.attributes["byobu.icon-badge"],label:o().translator.trans("fof-byobu.forum.notifications.pd_user_left_label")})}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map