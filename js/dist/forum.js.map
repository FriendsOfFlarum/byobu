{"version":3,"sources":["webpack://@fof/byobu/webpack/bootstrap","webpack://@fof/byobu/external \"flarum.core.compat['forum/app']\"","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/byobu/external \"flarum.core.compat['common/models/User']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/extend']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/ItemList']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/Model']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Button']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/models/Discussion']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/models/Group']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/Notification']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/LinkButton']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Badge']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/EventPost']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/username']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/highlight']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/UserPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/listItems']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/Component']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Switch']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionHero']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Modal']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/states/SearchState']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/Search']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/avatar']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Tooltip']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/utils/UserControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Dropdown']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/NotificationGrid']\"","webpack://@fof/byobu/./src/forum/events/RecipientLeft.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","webpack://@fof/byobu/./src/forum/pages/labels/RecipientLabel.tsx","webpack://@fof/byobu/./src/forum/pages/labels/recipientsLabels.tsx","webpack://@fof/byobu/./src/forum/events/RecipientsModified.js","webpack://@fof/byobu/./src/forum/extend/SettingsPage.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/byobu/./src/forum/search/sources/UserSearchSource.js","webpack://@fof/byobu/./src/forum/search/sources/GroupSearchSource.js","webpack://@fof/byobu/./src/forum/search/RecipientSearch.js","webpack://@fof/byobu/./src/forum/modals/AddRecipientModal.js","webpack://@fof/byobu/./src/forum/extend/Discussion.js","webpack://@fof/byobu/./src/forum/pages/discussions/PrivateDiscussionComposer.js","webpack://@fof/byobu/./src/forum/pages/labels/recipientCountLabel.js","webpack://@fof/byobu/./src/forum/extend/User.js","webpack://@fof/byobu/./src/forum/extend/index.ts","webpack://@fof/byobu/./src/forum/states/PrivateDiscussionListState.js","webpack://@fof/byobu/./src/forum/pages/discussions/PrivateDiscussionList.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://@fof/byobu/./src/forum/pages/PrivateComposing.js","webpack://@fof/byobu/./src/forum/pages/PrivateDiscussionsUserPage.js","webpack://@fof/byobu/./src/forum/pages/index.js","webpack://@fof/byobu/./src/forum/pages/routes.js","webpack://@fof/byobu/./src/forum/pages/PrivateDiscussionsPage.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionReplyNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionUserLeftNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionAddedNotification.js","webpack://@fof/byobu/./src/forum/notifications/index.js","webpack://@fof/byobu/./src/forum/modals/index.js","webpack://@fof/byobu/./src/forum/pages/discussions/index.js","webpack://@fof/byobu/./src/forum/index.ts","webpack://@fof/byobu/./src/forum/events/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","RecipientLeft","initAttrs","attrs","icon","app","forum","attribute","descriptionKey","EventPost","_objectWithoutPropertiesLoose","source","excluded","target","sourceKeys","keys","length","indexOf","RecipientLabel","view","vnode","label","this","recipient","link","newAttrs","style","className","classList","User","href","route","user","username","id","session","Group","class","namePlural","translator","trans","Component","recipientsLabel","recipients","otherAttrs","map","index","type","RecipientsModified","diff","diff1","diff2","store","filter","item","getById","content","post","usersAdded","usersRemoved","groupsAdded","groupsRemoved","added","concat","removed","oldRecipients","newRecipients","localeBase","descriptionData","data","extend","SettingsPage","items","add","Switch","component","state","blocksPd","onchange","blocksPdLoading","save","then","redraw","loading","_extends","assign","arguments","apply","UserSearchSource","query","cache","byobuResults","children","highlight","text","data-index","avatar","undefined","find","q","page","limit","pushResults","results","payload","result","push","GroupSearchSource","search","toLowerCase","all","group","substr","groupName","RecipientSearch","inputUuid","oninit","Math","random","toString","substring","oncreate","$search","$","on","e","addRecipient","focus","parentNode","clearTimeout","typingTimer","doSearch","setTimeout","getValue","setValue","sources","sourceItems","toArray","role","aria-live","selected","data-container","onclick","removeRecipient","for","open","focused","active","loadingSources","dom","placeholder","extractText","oninput","onfocus","hasFocus","onblur","in","LoadingIndicator","size","ItemList","discussion","canEditUserRecipients","canEditGroupRecipients","values","split","findRecipient","clear","preventDefault","remove","Search","AddRecipientModal","Stream","assignInitialRecipients","selectedRecipients","merge","recipientSearch","SearchState","isDismissible","recipientUsers","recipientGroups","title","helpText","Button","hide","select","metaKey","ctrlKey","submit","onsubmit","forEach","relationships","current","DiscussionPage","stream","update","modal","close","composer","show","Modal","Discussion","Model","hasMany","oldRecipientUsers","oldRecipientGroups","canEditRecipients","isPrivateDiscussion","badges","Badge","attributes","DiscussionListItem","DiscussionHero","DiscussionListState","params","include","DiscussionControls","history","back","long","PrivateDiscussionComposer","_isByobuComposer","titlePlaceholder","submitLabel","fields","param","addDefaultRecipients","users","groups","tags","chooseRecipients","headerItems","count","recipientCountLabel","getBy","createRecord","discussionList","refresh","set","loaded","DiscussionComposer","cannotBeDirectMessaged","unreadPrivateMessagesCount","UserControls","Promise","resolve","load","UserPage","slug","LinkButton","PrivateDiscussionListState","PrivateDiscussionList","DiscussionList","_defineProperties","props","descriptor","configurable","writable","PrivateComposing","Constructor","protoProps","staticProps","action","reject","LogInModal","itemClassName","disabled","canStartDiscussion","PrivateDiscussionsUserPage","changeSort","list","sort","handleChangeSort","loadUser","listItems","actionItems","viewItems","composing","sortMap","sortOptions","Dropdown","buttonClassName","routes","byobuUserPrivate","path","byobuPrivate","IndexPage","setTitle","compose","replace","PrivateDiscussionNotification","notification","subject","fromUser","Notification","PrivateDiscussionReplyNotification","postNumber","PrivateDiscussionUserLeftNotification","PrivateDiscussionAddedNotification","notificationComponents","byobuPrivateDiscussionCreated","byobuPrivateDiscussionReplied","PrivateDiscussionRepliedNotification","byobuRecipientRemoved","byobuPrivateDiscussionAdded","NotificationGrid","modals","discussions","initializers","postComponents","recipientsModified","recipientLeft","pages","notifications"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 44);\n","module.exports = flarum.core.compat['forum/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['common/models/User'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/utils/ItemList'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/models/Discussion'];","module.exports = flarum.core.compat['common/models/Group'];","module.exports = flarum.core.compat['forum/components/Notification'];","module.exports = flarum.core.compat['common/utils/classList'];","module.exports = flarum.core.compat['common/components/LinkButton'];","module.exports = flarum.core.compat['forum/states/DiscussionListState'];","module.exports = flarum.core.compat['forum/components/IndexPage'];","module.exports = flarum.core.compat['common/components/Badge'];","module.exports = flarum.core.compat['forum/components/EventPost'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/helpers/highlight'];","module.exports = flarum.core.compat['forum/components/UserPage'];","module.exports = flarum.core.compat['common/helpers/listItems'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['forum/components/SettingsPage'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['forum/components/DiscussionListItem'];","module.exports = flarum.core.compat['forum/components/DiscussionHero'];","module.exports = flarum.core.compat['forum/utils/DiscussionControls'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['forum/states/SearchState'];","module.exports = flarum.core.compat['forum/components/Search'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['forum/utils/UserControls'];","module.exports = flarum.core.compat['forum/components/DiscussionComposer'];","module.exports = flarum.core.compat['common/components/Dropdown'];","module.exports = flarum.core.compat['forum/components/DiscussionList'];","module.exports = flarum.core.compat['forum/components/LogInModal'];","module.exports = flarum.core.compat['forum/components/NotificationGrid'];","import app from 'flarum/forum/app';\nimport EventPost from 'flarum/forum/components/EventPost';\n\nexport default class RecipientLeft extends EventPost {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n  }\n\n  icon() {\n    return app.forum.attribute('byobu.icon-postAction');\n  }\n\n  descriptionKey() {\n    return 'fof-byobu.forum.post.recipients_modified.removed_self';\n  }\n}\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import type * as Mithril from 'mithril';\nimport username from 'flarum/common/helpers/username';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport classList from 'flarum/common/utils/classList';\nimport app from 'flarum/forum/app';\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\n\nexport interface IRecipientLabelAttrs extends ComponentAttrs, Mithril.Attributes {\n  recipient: User | Group;\n  link: string;\n}\n\nexport default class RecipientLabel extends Component<IRecipientLabelAttrs> {\n  view(vnode: Mithril.Vnode) {\n    const { recipient, link, ...newAttrs } = this.attrs;\n\n    newAttrs.style = newAttrs.style || {};\n    newAttrs.className = classList('RecipientLabel', newAttrs?.className);\n\n    if (link && recipient instanceof User) {\n      newAttrs.href = app.route.user(recipient);\n    }\n\n    let label: string;\n\n    if (recipient instanceof User) {\n      label = username(recipient);\n\n      if (!newAttrs.href && recipient.id() !== app?.session?.user?.id()) {\n        newAttrs.href = app.route.user(recipient);\n      }\n    } else if (recipient instanceof Group) {\n      return <span class={newAttrs.className}>{recipient.namePlural()}</span>;\n    } else {\n      newAttrs.className += ' none';\n      label = app.translator.trans('core.lib.username.deleted_text');\n    }\n\n    return <LinkButton {...newAttrs}>{label}</LinkButton>;\n  }\n}\n","import Group from 'flarum/common/models/Group';\nimport User from 'flarum/common/models/User';\nimport classList from 'flarum/common/utils/classList';\nimport RecipientLabel from './RecipientLabel';\n\nexport default function recipientsLabel(recipients?: (User | Group)[], attrs: Record<string, unknown> = {}): JSX.Element {\n  const { link, className, ...otherAttrs } = attrs;\n\n  otherAttrs.className = classList('RecipientsLabel', className);\n\n  return (\n    <span {...otherAttrs}>\n      {recipients?.map((recipient, index) => {\n        const type = recipient instanceof User ? 'u' : 'g';\n\n        return <RecipientLabel key={`${type}-${index}`} recipient={recipient} link={link} />;\n      })}\n      {!recipients && <RecipientLabel />}\n    </span>\n  );\n}\n","import app from 'flarum/forum/app';\nimport EventPost from 'flarum/forum/components/EventPost';\nimport recipientsLabel from '../pages/labels/recipientsLabels';\n\nexport default class RecipientsModified extends EventPost {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    function diff(diff1, diff2, store) {\n      return diff1.filter((item) => diff2.indexOf(item) === -1).map((id) => app.store.getById(store, id));\n    }\n\n    const content = attrs.post.content();\n\n    // For event posts existing before groups functionality.\n    if (!content['new'] && content.length == 2) {\n      const oldRecipients = attrs.post.content()[0];\n      const newRecipients = attrs.post.content()[1];\n      attrs.added = diff(newRecipients, oldRecipients, 'users');\n      attrs.removed = diff(oldRecipients, newRecipients, 'users');\n    } else {\n      let usersAdded = diff(content['new']['users'], content['old']['users'], 'users');\n      let usersRemoved = diff(content['old']['users'], content['new']['users'], 'users');\n      let groupsAdded = diff(content['new']['groups'], content['old']['groups'], 'groups');\n      let groupsRemoved = diff(content['old']['groups'], content['new']['groups'], 'groups');\n\n      attrs.added = usersAdded.concat(groupsAdded);\n      attrs.removed = usersRemoved.concat(groupsRemoved);\n    }\n  }\n\n  icon() {\n    return app.forum.attribute('byobu.icon-postAction');\n  }\n\n  descriptionKey() {\n    var localeBase = 'fof-byobu.forum.post.recipients_modified.';\n\n    if (this.attrs.added.length) {\n      if (this.attrs.removed.length) {\n        return localeBase + 'added_and_removed';\n      }\n\n      return localeBase + 'added';\n    }\n\n    return localeBase + 'removed';\n  }\n\n  descriptionData() {\n    const data = {};\n\n    if (this.attrs.added.length) {\n      data.added = recipientsLabel(this.attrs.added, { link: true });\n    }\n\n    if (this.attrs.removed.length) {\n      data.removed = recipientsLabel(this.attrs.removed, { link: true });\n    }\n\n    return data;\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport Switch from 'flarum/common/components/Switch';\n\nexport default () => {\n  privacyToggle();\n};\n\nfunction privacyToggle() {\n  extend(SettingsPage.prototype, 'privacyItems', function (items) {\n    items.add(\n      'byobu-block-dm',\n      Switch.component(\n        {\n          state: this.user.blocksPd(),\n          onchange: (value) => {\n            this.blocksPdLoading = true;\n\n            this.user.save({ blocksPd: value }).then(() => {\n              this.blocksPdLoading = false;\n              m.redraw();\n            });\n          },\n          loading: this.blocksPdLoading,\n        },\n        app.translator.trans('fof-byobu.forum.user.settings.block_pd')\n      )\n    );\n  });\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import app from 'flarum/forum/app';\nimport highlight from 'flarum/common/helpers/highlight';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\n\nexport default class UserSearchSource {\n  view(query) {\n    if (query.length < 3 || this.loading) return;\n\n    if (!app.cache.byobuResults) {\n      app.cache.byobuResults = [];\n    }\n\n    this.query = query;\n\n    if (!app.cache.byobuResults[this.query]) {\n      this.loading = true;\n\n      app.cache.byobuResults[this.query] = [];\n      app.store\n        .find('users', {\n          filter: { q: this.query + ' allows-pd' },\n          page: { limit: 5 },\n        })\n        .then(this.pushResults.bind(this));\n    } else\n      return [\n        <li className=\"Dropdown-header\">{app.translator.trans('core.forum.search.users_heading')}</li>,\n        app.cache.byobuResults[this.query].map((user) => {\n          const name = username(user);\n          const children = [highlight(name.text, this.query)];\n\n          return (\n            <li className=\"SearchResult\" data-index={'users:' + user.id()}>\n              <a data-index={'users:' + user.id()}>\n                {avatar(user)}\n                {{ ...name, text: undefined, children }}\n              </a>\n            </li>\n          );\n        }),\n      ];\n  }\n\n  pushResults(results) {\n    results.payload.data.map((result) => {\n      var user = app.store.getById('users', result.id);\n      app.cache.byobuResults[this.query].push(user);\n    });\n    this.loading = false;\n    m.redraw();\n  }\n}\n","import app from 'flarum/forum/app';\nimport highlight from 'flarum/common/helpers/highlight';\n\nexport default class GroupSearchSource {\n  search(query) {\n    return app.store.find('groups', {\n      filter: { q: query },\n      page: { limit: 5 },\n    });\n  }\n\n  view(query) {\n    query = query.toLowerCase();\n\n    const results = app.store.all('groups').filter((group) => group.namePlural().toLowerCase().substr(0, query.length) === query);\n\n    if (!results.length) return '';\n\n    return [\n      <li className=\"Dropdown-header\">{app.translator.trans('fof-byobu.forum.search.headings.groups')}</li>,\n      results.map((group) => {\n        const groupName = group.namePlural();\n        var name = highlight(groupName, query);\n\n        return (\n          <li className=\"SearchResult\" data-index={'groups:' + group.id()}>\n            <a data-index={'groups:' + group.id()}>\n              <span class=\"groupName\">{name}</span>\n            </a>\n          </li>\n        );\n      }),\n    ];\n  }\n}\n","import app from 'flarum/forum/app';\nimport Search from 'flarum/forum/components/Search';\nimport UserSearchSource from './sources/UserSearchSource';\nimport GroupSearchSource from './sources/GroupSearchSource';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport RecipientLabel from '../pages/labels/RecipientLabel';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport default class RecipientSearch extends Search {\n  /**\n   * Used to prevent duplicate IDs. Doesn't remove the possibility, but is extremely low.\n   */\n  inputUuid;\n\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.inputUuid = Math.random().toString(36).substring(2);\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    const $search = this;\n\n    this.$('.Search-results').on('click', (e) => {\n      const target = this.$('.SearchResult.active');\n\n      $search.addRecipient(target.data('index'));\n      $search.$('.RecipientsInput').focus();\n    });\n\n    this.$('.Search-results').on('touchstart', (e) => {\n      const target = this.$(e.target.parentNode);\n\n      $search.addRecipient(target.data('index'));\n      $search.$('.RecipientsInput').focus();\n    });\n\n    $('.RecipientsInput')\n      .on('input', () => {\n        clearTimeout(this.typingTimer);\n        this.doSearch = false;\n        this.typingTimer = setTimeout(() => {\n          this.doSearch = true;\n          m.redraw();\n        }, 900);\n      })\n      .on('keydown', () => {\n        clearTimeout(this.typingTimer);\n      });\n\n    super.oncreate(vnode);\n  }\n\n  view() {\n    if (typeof this.state.getValue() === 'undefined') {\n      this.state.setValue('');\n    }\n\n    const loading = this.state.getValue() && this.state.getValue().length >= 3;\n\n    if (!this.sources) {\n      this.sources = this.sourceItems().toArray();\n    }\n\n    return (\n      <div role=\"search\" className=\"Search\">\n        <div className=\"RecipientsInput-selected RecipientsLabel\" aria-live=\"polite\">\n          <h4>{app.translator.trans('fof-byobu.forum.modal.labels.selected_users')}</h4>\n          <p>{app.translator.trans('fof-byobu.forum.modal.help.selected_users')}</p>\n\n          {this.attrs\n            .selected()\n            .toArray()\n            .map((recipient) => {\n              return (\n                <Tooltip text={app.translator.trans('fof-byobu.forum.modal.help.click_user_to_remove_tooltip')}>\n                  <RecipientLabel data-container=\"body\" recipient={recipient} onclick={(e) => this.removeRecipient(recipient, e)} />\n                </Tooltip>\n              );\n            })}\n        </div>\n\n        <div className=\"Form-group\">\n          <label for={`byobu-addrecipient-search-input-${this.inputUuid}`}>{app.translator.trans('fof-byobu.forum.modal.labels.search_field')}</label>\n\n          <div className=\"AddRecipientModal-form-input Search-input\">\n            <input\n              id={`byobu-addrecipient-search-input-${this.inputUuid}`}\n              className={classList('RecipientsInput', 'FormControl', {\n                open: !!this.state.getValue(),\n                focused: !!this.state.getValue(),\n                active: !!this.state.getValue(),\n                loading: !!this.loadingSources,\n              })}\n              oncreate={(vnode) => vnode.dom.focus()}\n              type=\"search\"\n              placeholder={extractText(app.translator.trans('fof-byobu.forum.input.search_recipients'))}\n              value={this.state.getValue()}\n              oninput={(e) => this.state.setValue(e.target.value)}\n              onfocus={() => (this.hasFocus = true)}\n              onblur={() => (this.hasFocus = false)}\n            />\n            <ul\n              className={classList('Dropdown-menu', 'Search-results', 'fade', {\n                in: !!loading,\n              })}\n            >\n              {!this.doSearch\n                ? LoadingIndicator.component({ size: 'tiny', className: 'Button Button--icon Button--link' })\n                : this.sources.map((source) => source.view(this.state.getValue()))}\n            </ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Build an item list of SearchSources.\n   *\n   * @return {ItemList}\n   */\n  sourceItems() {\n    const items = new ItemList();\n\n    // Add user source based on permissions.\n    if (\n      (!this.attrs.discussion && app.forum.attribute('canStartPrivateDiscussionWithUsers')) ||\n      (this.attrs.discussion && this.attrs.discussion.canEditUserRecipients())\n    ) {\n      items.add('users', new UserSearchSource());\n    }\n\n    // Add group source based on permissions.\n    if (\n      (!this.attrs.discussion && app.forum.attribute('canStartPrivateDiscussionWithGroups')) ||\n      (this.attrs.discussion && this.attrs.discussion.canEditGroupRecipients())\n    ) {\n      items.add('groups', new GroupSearchSource());\n    }\n\n    return items;\n  }\n\n  /**\n   * Adds a recipient.\n   *\n   * @param value\n   */\n  addRecipient(value) {\n    let values = value.split(':'),\n      type = values[0],\n      id = values[1];\n\n    let recipient = this.findRecipient(type, id);\n\n    this.attrs.selected().add(value, recipient);\n\n    this.state.clear();\n  }\n\n  /**\n   * Removes a recipient.\n   *\n   * @param recipient\n   */\n  removeRecipient(recipient, e) {\n    e.preventDefault();\n\n    let type;\n\n    if (recipient instanceof User) {\n      type = 'users';\n    }\n    if (recipient instanceof Group) {\n      type = 'groups';\n    }\n\n    this.attrs.selected().remove(type + ':' + recipient.id());\n  }\n\n  /**\n   * Loads a recipient from the global store.\n   *\n   * @param store\n   * @param id\n   * @returns {Model}\n   */\n  findRecipient(store, id) {\n    return app.store.getById(store, id);\n  }\n}\n","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Stream from 'flarum/common/utils/Stream';\nimport SearchState from 'flarum/forum/states/SearchState';\nimport RecipientSearch from '../search/RecipientSearch';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\n\nexport default class AddRecipientModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.selected = Stream(new ItemList());\n\n    if (this.attrs.discussion) {\n      // Adds recipients of the currently viewed discussion.\n      this.assignInitialRecipients(this.attrs.discussion);\n    } else if (this.attrs.selectedRecipients && this.attrs.selectedRecipients.toArray().length > 0) {\n      // Adds previously selected recipients.\n      this.selected().merge(this.attrs.selectedRecipients);\n    } else {\n      // Adds the current user in case there are no selected recipients yet and this is a new discussion.\n      this.selected().add('users:' + app.session.user.id(), app.session.user);\n    }\n\n    this.recipientSearch = new SearchState();\n  }\n\n  isDismissible() {\n    return false;\n  }\n\n  assignInitialRecipients(discussion) {\n    discussion.recipientUsers().map((user) => {\n      this.selected().add('users:' + user.id(), user);\n    });\n    discussion.recipientGroups().map((group) => {\n      this.selected().add('groups:' + group.id(), group);\n    });\n  }\n\n  className() {\n    return 'AddRecipientModal';\n  }\n\n  title() {\n    return this.attrs.discussion\n      ? app.translator.trans('fof-byobu.forum.modal.titles.update_recipients', { title: <em>{this.attrs.discussion.title()}</em> })\n      : app.translator.trans('fof-byobu.forum.modal.titles.add_recipients');\n  }\n\n  helpText() {\n    return this.attrs.discussion\n      ? app.translator.trans('fof-byobu.forum.modal.help.update_recipients')\n      : app.translator.trans('fof-byobu.forum.modal.help.add_recipients');\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        <div class=\"AddRecipientModal-help\">{this.helpText()}</div>\n        <div className=\"AddRecipientModal-form\">\n          {RecipientSearch.component({\n            state: this.recipientSearch,\n            selected: this.selected,\n            discussion: this.attrs.discussion,\n          })}\n          <div className=\"AddRecipientModal-form-submit App-primaryControl\">\n            {Button.component(\n              {\n                type: 'submit',\n                className: 'Button Button--primary',\n                icon: 'fas fa-check',\n              },\n              app.translator.trans('fof-byobu.forum.buttons.submit')\n            )}\n            {Button.component(\n              {\n                onclick: this.hide.bind(this),\n                className: 'Button Button--cancel',\n              },\n              app.translator.trans('fof-byobu.forum.buttons.cancel')\n            )}\n          </div>\n        </div>\n      </div>,\n    ];\n  }\n\n  select(e) {\n    // Ctrl + Enter submits the selection, just Enter completes the current entry\n    if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\n      if (this.selected().length) {\n        this.$('form').submit();\n      }\n    }\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const discussion = this.attrs.discussion;\n    const recipients = this.selected();\n\n    let recipientGroups = [];\n    let recipientUsers = [];\n\n    recipients.toArray().forEach((recipient) => {\n      if (recipient instanceof User) {\n        recipientUsers.push(recipient);\n      }\n      if (recipient instanceof Group) {\n        recipientGroups.push(recipient);\n      }\n    });\n\n    // Recipients are updated here for existing discussions here.\n    if (discussion) {\n      discussion.save({ relationships: { recipientUsers, recipientGroups } }).then(() => {\n        if (app.current instanceof DiscussionPage) {\n          app.current.stream.update();\n        }\n        m.redraw();\n      });\n    }\n\n    // Use the onsubmit callback to trigger an update in the DiscussionComposer\n    if (this.attrs.onsubmit) this.attrs.onsubmit(recipients);\n\n    app.modal.close();\n\n    if (!this.attrs.discussion) {\n      app.composer.show();\n    }\n\n    e.redraw = false;\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\nimport Badge from 'flarum/common/components/Badge';\nimport Discussion from 'flarum/common/models/Discussion';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport Button from 'flarum/common/components/Button';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionHero from 'flarum/forum/components/DiscussionHero';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport recipientsLabel from '../pages/labels/recipientsLabels';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport AddRecipientModal from './../modals/AddRecipientModal';\n\nexport default () => {\n  attributes();\n  badges();\n  index();\n  hero();\n  apiInclude();\n  controls();\n};\n\nconst add = function (discussion, items, long) {\n  let recipients = [];\n\n  if (discussion.recipientUsers().length) {\n    recipients = recipients.concat(discussion.recipientUsers());\n  }\n\n  if (discussion.recipientGroups().length) {\n    recipients = recipients.concat(discussion.recipientGroups());\n  }\n\n  if (recipients && recipients.length) {\n    if (long) {\n      items.add('recipients', recipientsLabel(recipients), 10);\n    } else {\n      items.add('recipients', recipientsLabel(recipients, { link: true }), 4);\n    }\n  }\n};\n\nfunction badges() {\n  extend(Discussion.prototype, 'badges', function (badges) {\n    if (this.recipientUsers().length || this.recipientGroups().length) {\n      badges.add(\n        'private',\n        Badge.component({\n          type: 'private',\n          label: app.translator.trans('fof-byobu.forum.badges.is_private.tooltip'),\n          icon: app.forum.data.attributes['byobu.icon-badge'],\n        }),\n        10\n      );\n    }\n  });\n}\n\nfunction index() {\n  extend(DiscussionListItem.prototype, 'infoItems', function (items) {\n    const discussion = this.attrs.discussion;\n\n    add(discussion, items, true);\n  });\n}\n\nfunction hero() {\n  extend(DiscussionHero.prototype, 'items', function (items) {\n    const discussion = this.attrs.discussion;\n\n    add(discussion, items, false);\n  });\n}\n\nfunction apiInclude() {\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    params.include.push('recipientUsers');\n    params.include.push('recipientGroups');\n  });\n}\n\nfunction controls() {\n  extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n    if (discussion.canEditRecipients()) {\n      items.add(\n        'recipients',\n        Button.component(\n          {\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            onclick: () => app.modal.show(AddRecipientModal, { discussion }),\n          },\n          app.translator.trans('fof-byobu.forum.buttons.edit_recipients')\n        )\n      );\n    }\n    if (discussion && discussion.recipientUsers().find((user) => user.id() === app.session.user.id())) {\n      items.add(\n        'remove',\n        Button.component(\n          {\n            icon: 'fas fa-user-slash',\n            onclick: () => {\n              if (discussion) {\n                let recipients = new ItemList();\n                discussion.recipientUsers().map((user) => {\n                  if (app.session.user.id() !== user.id()) {\n                    recipients.add('users:' + user.id(), user);\n                  }\n                });\n\n                let recipientGroups = [];\n                let recipientUsers = [];\n\n                recipients.toArray().forEach((recipient) => {\n                  if (recipient instanceof User) {\n                    recipientUsers.push(recipient);\n                  }\n                  if (recipient instanceof Group) {\n                    recipientGroups.push(recipient);\n                  }\n                });\n\n                discussion\n                  .save({\n                    relationships: {\n                      recipientUsers,\n                      recipientGroups,\n                    },\n                  })\n                  .then(() => app.history.back());\n              }\n            },\n          },\n          app.translator.trans('fof-byobu.forum.buttons.remove_from_discussion')\n        )\n      );\n    }\n  });\n}\n\nfunction attributes() {\n  Discussion.prototype.recipientUsers = Model.hasMany('recipientUsers');\n  Discussion.prototype.oldRecipientUsers = Model.hasMany('oldRecipientUsers');\n  Discussion.prototype.recipientGroups = Model.hasMany('recipientGroups');\n  Discussion.prototype.oldRecipientGroups = Model.hasMany('oldRecipientGroups');\n\n  Discussion.prototype.canEditRecipients = Model.attribute('canEditRecipients');\n  Discussion.prototype.canEditUserRecipients = Model.attribute('canEditUserRecipients');\n  Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\n  Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\n\n  Discussion.prototype.isPrivateDiscussion = Model.attribute('isPrivateDiscussion');\n}\n","import app from 'flarum/forum/app';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport AddRecipientModal from '../../modals/AddRecipientModal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport recipientCountLabel from '../labels/recipientCountLabel';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\n\nexport default class PrivateDiscussionComposer extends DiscussionComposer {\n  /**\n   * Tells other extensions that this composer is a Byobu composer.\n   */\n  _isByobuComposer = true;\n\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    attrs.titlePlaceholder = app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder');\n    attrs.submitLabel = app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button');\n  }\n\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.composer.fields.recipients = this.attrs.recipients || new ItemList();\n\n    this.composer.fields.recipientUsers = this.attrs.recipientUsers || [];\n    this.composer.fields.recipientGroups = this.attrs.recipientGroups || [];\n\n    const username = m.route.param('username');\n\n    if (typeof username !== 'undefined') {\n      this.addDefaultRecipients(username);\n    }\n  }\n\n  data() {\n    let data = super.data();\n\n    const users = [];\n    const groups = [];\n\n    if (this.composer.fields.recipients !== undefined) {\n      this.composer.fields.recipients.toArray().forEach((recipient) => {\n        if (recipient instanceof User) {\n          users.push(recipient);\n        }\n\n        if (recipient instanceof Group) {\n          groups.push(recipient);\n        }\n      });\n    }\n\n    data.relationships = data.relationships || {};\n\n    if (users.length) {\n      data.relationships.recipientUsers = users;\n    }\n\n    if (groups.length) {\n      data.relationships.recipientGroups = groups;\n    }\n\n    delete data.relationships.tags;\n\n    return data;\n  }\n\n  chooseRecipients() {\n    app.modal.show(AddRecipientModal, {\n      selectedRecipients: this.composer.fields.recipients,\n      onsubmit: (recipients) => {\n        this.composer.fields.recipients = recipients;\n\n        // Focus on recipient autocomplete field.\n        this.$('.RecipientsInput').focus();\n      },\n    });\n  }\n\n  headerItems() {\n    let items = super.headerItems();\n\n    items.remove('tags');\n\n    if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\n      const recipients = this.composer.fields.recipients.toArray();\n\n      items.add(\n        'recipients',\n        <a className=\"PrivateDiscussionComposer-changeRecipients\" onclick={this.chooseRecipients.bind(this)}>\n          {recipients.length ? (\n            recipientCountLabel(recipients.length)\n          ) : (\n            <span className=\"RecipientLabel none\">{app.translator.trans('fof-byobu.forum.buttons.add_recipients')}</span>\n          )}\n        </a>,\n        5\n      );\n    }\n\n    return items;\n  }\n\n  addDefaultRecipients(username) {\n    const user = app.store.getBy('users', 'username', username);\n\n    this.composer.fields.recipients.add('users:' + app.session.user.id(), app.session.user);\n\n    if (user.id() !== app.session.user.id()) {\n      this.composer.fields.recipients.add('users:' + user.id(), user);\n    }\n  }\n\n  onsubmit() {\n    this.loading = true;\n\n    const recipients = this.composer.fields.recipients.toArray();\n\n    if (recipients.length < 2) {\n      this.chooseRecipients();\n\n      this.loading = false;\n    } else {\n      const data = this.data();\n\n      app.store\n        .createRecord('discussions')\n        .save(data)\n        .then((discussion) => {\n          if (app.cache.discussionList) {\n            app.cache.discussionList.refresh();\n          }\n          m.route.set(app.route.discussion(discussion));\n\n          app.composer.hide();\n        }, this.loaded.bind(this));\n    }\n  }\n}\n","import app from 'flarum/forum/app';\n\nexport default function recipientCountLabel(count, attrs = {}) {\n  attrs.style = attrs.style || {};\n  attrs.className = 'RecipientLabel ' + (attrs.className || '');\n\n  var label = app.translator.trans('fof-byobu.forum.labels.recipients', { count });\n\n  return m('span', attrs, <span className=\"RecipientLabel-text\">{label}</span>);\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport PrivateDiscussionComposer from './../pages/discussions/PrivateDiscussionComposer';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport LinkButton from 'flarum/common/components/LinkButton';\n\nexport default () => {\n  attributes();\n  message();\n  sharedMessageHistory();\n};\n\nfunction message() {\n  extend(UserControls, 'userControls', function (items, user) {\n    if (\n      app.session.user &&\n      app.session.user.id() !== user.id() &&\n      app.forum.attribute('canStartPrivateDiscussion') &&\n      (user.blocksPd() === false || (app.forum.attribute('canStartPrivateDiscussionWithBlockers') && user.cannotBeDirectMessaged()))\n    ) {\n      items.add(\n        'private-discussion',\n        Button.component(\n          {\n            icon: app.forum.attribute('byobu.icon-badge'),\n            onclick: (e) => {\n              e.preventDefault();\n\n              return new Promise((resolve) => {\n                let recipients = new ItemList();\n                recipients.add('users:' + app.session.user.id(), app.session.user);\n                recipients.add('users:' + user.id(), user);\n\n                PrivateDiscussionComposer.prototype.recipients = recipients;\n\n                app.composer.load(PrivateDiscussionComposer, {\n                  user: app.session.user,\n                  recipients: recipients,\n                  recipientUsers: recipients,\n                  titlePlaceholder: app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder'),\n                  submitLabel: app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button'),\n                });\n                app.composer.show();\n\n                return resolve(app.composer);\n              });\n            },\n          },\n          app.translator.trans('fof-byobu.forum.buttons.send_pd', { username: user.username() })\n        )\n      );\n    }\n\n    return items;\n  });\n}\n\nfunction sharedMessageHistory() {\n  extend(UserPage.prototype, 'navItems', function (items) {\n    const href = app.route('byobuUserPrivate', { username: this.user.slug() });\n\n    // Hide links from guests if they are not already on the page\n    if (!app.session.user && m.route.get() !== href) return;\n    // Hide link for your own page.\n    if (app.session.user === this.user) return;\n\n    items.add(\n      'byobu',\n      LinkButton.component(\n        {\n          href,\n          icon: app.forum.attribute('byobu.icon-badge'),\n        },\n        app.translator.trans('fof-byobu.forum.user.byobu_link')\n      ),\n      85\n    );\n  });\n}\n\nfunction attributes() {\n  User.prototype.blocksPd = Model.attribute('blocksPd');\n  User.prototype.cannotBeDirectMessaged = Model.attribute('cannotBeDirectMessaged');\n  User.prototype.unreadPrivateMessagesCount = Model.attribute('unreadPrivateMessagesCount');\n}\n","import SettingsPage from './SettingsPage';\nimport Discussion from './Discussion';\nimport User from './User';\n\nexport default () => {\n  Discussion();\n  SettingsPage();\n  User();\n};\n","import DiscussionListState from 'flarum/forum/states/DiscussionListState';\n\nexport default class PrivateDiscussionListState extends DiscussionListState {}\n","import DiscussionList from 'flarum/forum/components/DiscussionList';\n\nexport default class PrivateDiscussionList extends DiscussionList {}\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport PrivateDiscussionComposer from './discussions/PrivateDiscussionComposer';\n\nexport default class PrivateComposing {\n  constructor(recipient) {\n    this.recipient = recipient;\n  }\n\n  action(e) {\n    e.preventDefault();\n\n    return new Promise((resolve, reject) => {\n      if (app.session.user) {\n        let recipients = new ItemList();\n\n        recipients.add('users:' + app.session.user.id(), app.session.user);\n\n        if (this.recipient && app.session.user.id() !== this.recipient.id()) {\n          recipients.add('users:' + this.recipient.id(), this.recipient);\n        }\n\n        app.composer.load(PrivateDiscussionComposer, {\n          user: app.session.user,\n          recipients: recipients,\n          recipientUsers: recipients,\n        });\n\n        app.composer.show();\n\n        return resolve();\n      } else {\n        app.modal.show(LogInModal);\n\n        return reject();\n      }\n    });\n  }\n\n  component() {\n    return Button.component(\n      {\n        icon: 'fas fa-pen',\n        className: 'Button Button--primary IndexPage-newDiscussion',\n        itemClassName: 'App-primaryControl fof-byobu_primaryControl',\n        onclick: this.action.bind(this),\n        disabled: !this.canStartDiscussion,\n      },\n      app.translator.trans(this.canStartDiscussion ? 'fof-byobu.forum.nav.start_button' : 'core.forum.index.cannot_start_discussion_button')\n    );\n  }\n\n  get canStartDiscussion() {\n    return app.session.user && app.forum.attribute('canStartPrivateDiscussion');\n  }\n}\n","import app from 'flarum/forum/app';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport PrivateDiscussionListState from '../states/PrivateDiscussionListState';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport listItems from 'flarum/common/helpers/listItems';\nimport PrivateDiscussionList from './discussions/PrivateDiscussionList';\nimport PrivateComposing from './PrivateComposing';\n\nexport default class PrivateDiscussionsUserPage extends UserPage {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.changeSort('latest');\n  }\n\n  show(user) {\n    // We can not create the list in init because the user will not be available if it has to be loaded asynchronously\n    this.list = new PrivateDiscussionListState({\n      q: `byobu:${user.slug()} is:private`,\n      sort: this.sort,\n    });\n\n    this.list.refresh();\n\n    // We call the parent method after creating the list, this way the this.list property\n    // is set before content() is called for the first time\n    super.show(user);\n  }\n\n  handleChangeSort(sort, e) {\n    e.preventDefault();\n\n    this.changeSort(sort);\n  }\n\n  changeSort(sort) {\n    this.sort = sort;\n    this.loadUser(m.route.param('username'));\n  }\n\n  content() {\n    return (\n      <div className=\"DiscussionsUserPage\">\n        <div className=\"DiscussionsUserPage-toolbar\">\n          <ul className=\"DiscussionsUserPage-toolbar-action\">{listItems(this.actionItems().toArray())}</ul>\n          <ul className=\"DiscussionsUserPage-toolbar-view\">{listItems(this.viewItems().toArray())}</ul>\n        </div>\n        <PrivateDiscussionList state={this.list}></PrivateDiscussionList>\n      </div>\n    );\n  }\n\n  actionItems() {\n    let composing = new PrivateComposing(this.user);\n\n    const items = new ItemList();\n\n    if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\n      items.add('start_private', composing.component());\n    }\n\n    return items;\n  }\n\n  viewItems() {\n    const items = new ItemList();\n    const sortMap = this.list.sortMap();\n\n    const sortOptions = {};\n    for (const i in sortMap) {\n      sortOptions[i] = app.translator.trans('core.forum.index_sort.' + i + '_button');\n    }\n\n    items.add(\n      'sort',\n      Dropdown.component(\n        {\n          buttonClassName: 'Button',\n          label: sortOptions[this.sort] || Object.keys(sortMap).map((key) => sortOptions[key])[0],\n        },\n        Object.keys(sortOptions).map((value) => {\n          const label = sortOptions[value];\n          const active = (this.sort || Object.keys(sortMap)[0]) === value;\n\n          return Button.component(\n            {\n              icon: active ? 'fas fa-check' : true,\n              onclick: this.handleChangeSort.bind(this, value),\n              active: active,\n            },\n            label\n          );\n        })\n      )\n    );\n\n    return items;\n  }\n}\n","import routes from './routes';\nimport PrivateDiscussionsPage from './PrivateDiscussionsPage';\n\nexport default () => {\n  routes();\n  PrivateDiscussionsPage();\n};\n","import app from 'flarum/forum/app';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport PrivateDiscussionsUserPage from './PrivateDiscussionsUserPage';\n\nexport default () => {\n  app.routes.byobuUserPrivate = { path: '/u/:username/private', component: PrivateDiscussionsUserPage };\n  app.routes.byobuPrivate = { path: '/private', component: IndexPage };\n};\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport PrivateComposing from './PrivateComposing';\n\nexport default () => {\n  extend(IndexPage.prototype, 'navItems', (items) => {\n    const user = app.session.user;\n\n    if (user) {\n      items.add(\n        'privateDiscussions',\n        LinkButton.component(\n          {\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            href: app.route('byobuPrivate'),\n          },\n          app.translator.trans('fof-byobu.forum.nav.nav_item')\n        ),\n        75\n      );\n    }\n  });\n\n  extend(IndexPage.prototype, 'setTitle', function () {\n    if (app.current.get('routeName') === 'byobuPrivate') {\n      app.setTitle(app.translator.trans('fof-byobu.forum.user.dropdown_label'));\n    }\n  });\n\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    if (app.current.get('routeName') === 'byobuPrivate') {\n      params.filter.q = (params.filter.q || '') + ' is:private';\n\n      params.include.push('recipientUsers');\n      params.include.push('recipientGroups');\n    }\n  });\n\n  extend(IndexPage.prototype, 'sidebarItems', function (items) {\n    if (app.current.get('routeName') === 'byobuPrivate') {\n      let compose = new PrivateComposing();\n\n      items.replace('newDiscussion', compose.component());\n    }\n  });\n};\n","import app from 'flarum/forum/app';\nimport Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionNotification extends Notification {\n  icon() {\n    return app.forum.attribute('byobu.icon-badge');\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n    const discussion = notification.subject();\n\n    return app.route.discussion(discussion);\n  }\n\n  content() {\n    const user = this.attrs.notification.fromUser();\n    return app.translator.trans('fof-byobu.forum.notifications.pd_text', {\n      user: user,\n    });\n  }\n}\n","import app from 'flarum/forum/app';\nimport Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionReplyNotification extends Notification {\n  icon() {\n    return 'fas fa-reply';\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n    const discussion = notification.subject();\n    const content = notification.content() || {};\n\n    return app.route.discussion(discussion, content.postNumber);\n  }\n\n  content() {\n    const user = this.attrs.notification.fromUser();\n    return app.translator.trans('fof-byobu.forum.notifications.pd_reply_text', {\n      user: user,\n    });\n  }\n}\n","import app from 'flarum/forum/app';\nimport Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionUserLeftNotification extends Notification {\n  icon() {\n    return app.forum.attribute('byobu.icon-badge');\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n    const discussion = notification.subject();\n\n    return app.route.discussion(discussion);\n  }\n\n  content() {\n    const user = this.attrs.notification.fromUser();\n    return app.translator.trans('fof-byobu.forum.notifications.pd_user_left_text', {\n      user: user,\n    });\n  }\n}\n","import app from 'flarum/forum/app';\nimport Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionAddedNotification extends Notification {\n  icon() {\n    return app.forum.attribute('byobu.icon-badge');\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n    const discussion = notification.subject();\n\n    return app.route.discussion(discussion);\n  }\n\n  content() {\n    const user = this.attrs.notification.fromUser();\n    return app.translator.trans('fof-byobu.forum.notifications.pd_added_text', {\n      user: user,\n    });\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport NotificationGrid from 'flarum/forum/components/NotificationGrid';\nimport PrivateDiscussionNotification from './PrivateDiscussionNotification';\nimport PrivateDiscussionRepliedNotification from './PrivateDiscussionReplyNotification';\nimport PrivateDiscussionUserLeftNotification from './PrivateDiscussionUserLeftNotification';\nimport PrivateDiscussionAddedNotification from './PrivateDiscussionAddedNotification';\n\nexport default function () {\n  app.notificationComponents.byobuPrivateDiscussionCreated = PrivateDiscussionNotification;\n  app.notificationComponents.byobuPrivateDiscussionReplied = PrivateDiscussionRepliedNotification;\n  app.notificationComponents.byobuRecipientRemoved = PrivateDiscussionUserLeftNotification;\n  app.notificationComponents.byobuPrivateDiscussionAdded = PrivateDiscussionAddedNotification;\n\n  grid();\n}\n\nfunction grid() {\n  // Add notification preferences.\n  extend(NotificationGrid.prototype, 'notificationTypes', function (items) {\n    items.add('byobuPrivateDiscussionCreated', {\n      name: 'byobuPrivateDiscussionCreated',\n      icon: app.forum.data.attributes['byobu.icon-badge'],\n      label: app.translator.trans('fof-byobu.forum.notifications.pd_label'),\n    });\n    items.add('byobuPrivateDiscussionReplied', {\n      name: 'byobuPrivateDiscussionReplied',\n      icon: app.forum.data.attributes['byobu.icon-badge'],\n      label: app.translator.trans('fof-byobu.forum.notifications.pd_reply_label'),\n    });\n    items.add('byobuPrivateDiscussionAdded', {\n      name: 'byobuPrivateDiscussionAdded',\n      icon: app.forum.data.attributes['byobu.icon-badge'],\n      label: app.translator.trans('fof-byobu.forum.notifications.pd_added_label'),\n    });\n    items.add('byobuRecipientRemoved', {\n      name: 'byobuRecipientRemoved',\n      icon: app.forum.data.attributes['byobu.icon-badge'],\n      label: app.translator.trans('fof-byobu.forum.notifications.pd_user_left_label'),\n    });\n  });\n}\n","import AddRecipientModal from './AddRecipientModal';\n\nexport const modals = {\n  AddRecipientModal: AddRecipientModal,\n};\n","import PrivateDiscussionComposer from './PrivateDiscussionComposer';\nimport PrivateDiscussionList from './PrivateDiscussionList';\n\nexport const discussions = {\n  PrivateDiscussionComposer: PrivateDiscussionComposer,\n  PrivateDiscussionList: PrivateDiscussionList,\n};\n","import app from 'flarum/forum/app';\nimport events from './events';\nimport extend from './extend';\nimport pages from './pages';\nimport notifications from './notifications';\n\nexport * from './modals';\nexport * from './pages/discussions';\n\napp.initializers.add('fof-byobu', function () {\n  events();\n  extend();\n\n  pages();\n  notifications();\n});\n","import app from 'flarum/forum/app';\nimport RecipientLeft from './RecipientLeft';\nimport RecipientsModified from './RecipientsModified';\n\nexport default () => {\n  app.postComponents.recipientsModified = RecipientsModified;\n  app.postComponents.recipientLeft = RecipientLeft;\n};\n"],"sourceRoot":""}