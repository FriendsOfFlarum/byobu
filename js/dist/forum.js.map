{"version":3,"sources":["webpack://@fof/byobu/webpack/bootstrap","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/byobu/external \"flarum.core.compat['common/extend']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/models/User']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/ItemList']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/app']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/Model']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Button']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/models/Group']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/models/Discussion']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/Notification']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/LinkButton']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Badge']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/EventPost']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/username']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/highlight']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/UserPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/listItems']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/Component']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Switch']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionHero']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Modal']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/states/SearchState']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/Search']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/helpers/avatar']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Tooltip']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/utils/UserControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@fof/byobu/external \"flarum.core.compat['common/components/Dropdown']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@fof/byobu/external \"flarum.core.compat['forum/components/NotificationGrid']\"","webpack://@fof/byobu/./src/forum/events/RecipientLeft.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","webpack://@fof/byobu/./src/forum/pages/labels/RecipientLabel.tsx","webpack://@fof/byobu/./src/forum/pages/labels/recipientsLabels.tsx","webpack://@fof/byobu/./src/forum/events/RecipientsModified.js","webpack://@fof/byobu/./src/forum/extend/SettingsPage.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/byobu/./src/forum/search/sources/UserSearchSource.js","webpack://@fof/byobu/./src/forum/search/sources/GroupSearchSource.js","webpack://@fof/byobu/./src/forum/search/RecipientSearch.js","webpack://@fof/byobu/./src/forum/modals/AddRecipientModal.js","webpack://@fof/byobu/./src/forum/extend/Discussion.js","webpack://@fof/byobu/./src/forum/pages/discussions/PrivateDiscussionComposer.js","webpack://@fof/byobu/./src/forum/pages/labels/recipientCountLabel.js","webpack://@fof/byobu/./src/forum/extend/User.js","webpack://@fof/byobu/./src/forum/extend/index.js","webpack://@fof/byobu/./src/forum/states/PrivateDiscussionListState.js","webpack://@fof/byobu/./src/forum/pages/discussions/PrivateDiscussionList.js","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://@fof/byobu/./src/forum/pages/PrivateComposing.js","webpack://@fof/byobu/./src/forum/pages/PrivateDiscussionsUserPage.js","webpack://@fof/byobu/./src/forum/pages/index.js","webpack://@fof/byobu/./src/forum/pages/routes.js","webpack://@fof/byobu/./src/forum/pages/PrivateDiscussionsPage.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionReplyNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionUserLeftNotification.js","webpack://@fof/byobu/./src/forum/notifications/PrivateDiscussionAddedNotification.js","webpack://@fof/byobu/./src/forum/notifications/index.js","webpack://@fof/byobu/./src/forum/modals/index.js","webpack://@fof/byobu/./src/forum/pages/discussions/index.js","webpack://@fof/byobu/./src/forum/index.js","webpack://@fof/byobu/./src/forum/events/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","flarum","core","compat","RecipientLeft","initAttrs","attrs","icon","app","forum","data","attributes","descriptionKey","EventPost","_objectWithoutPropertiesLoose","source","excluded","target","sourceKeys","keys","length","indexOf","RecipientLabel","view","vnode","label","this","recipient","link","newAttrs","style","className","classList","href","User","username","id","session","user","route","Group","class","namePlural","translator","trans","Component","recipientsLabel","recipients","otherAttrs","map","type","RecipientsModified","diff","diff1","diff2","store","filter","item","getById","content","post","usersAdded","usersRemoved","groupsAdded","groupsRemoved","added","concat","removed","oldRecipients","newRecipients","localeBase","descriptionData","extend","SettingsPage","items","add","Switch","component","state","blocksPd","onchange","blocksPdLoading","save","then","redraw","loading","privacyToggle","_extends","assign","arguments","apply","UserSearchSource","query","cache","byobuResults","children","highlight","text","data-index","avatar","undefined","find","q","page","limit","pushResults","results","payload","result","push","GroupSearchSource","search","toLowerCase","all","group","substr","groupName","RecipientSearch","inputUuid","oninit","Math","random","toString","substring","oncreate","$search","$","on","e","addRecipient","focus","parentNode","clearTimeout","typingTimer","doSearch","setTimeout","getValue","setValue","sources","sourceItems","toArray","role","aria-live","selected","data-container","onclick","removeRecipient","for","open","focused","active","loadingSources","dom","placeholder","extractText","oninput","onfocus","hasFocus","onblur","in","LoadingIndicator","size","ItemList","discussion","attribute","canEditUserRecipients","canEditGroupRecipients","values","split","findRecipient","clear","preventDefault","remove","Search","AddRecipientModal","Stream","assignInitialRecipients","selectedRecipients","merge","recipientSearch","SearchState","isDismissible","recipientUsers","recipientGroups","title","helpText","Button","hide","select","metaKey","ctrlKey","index","submit","onsubmit","forEach","relationships","current","DiscussionPage","stream","update","modal","close","composer","show","Modal","Discussion","Model","hasMany","oldRecipientUsers","oldRecipientGroups","canEditRecipients","badges","Badge","DiscussionListItem","DiscussionHero","DiscussionListState","params","include","DiscussionControls","history","back","long","PrivateDiscussionComposer","titlePlaceholder","submitLabel","fields","param","addDefaultRecipients","users","groups","tags","chooseRecipients","headerItems","count","recipientCountLabel","getBy","createRecord","discussionList","refresh","set","loaded","DiscussionComposer","cannotBeDirectMessaged","unreadPrivateMessagesCount","UserControls","Promise","resolve","load","message","UserPage","LinkButton","sharedMessageHistory","PrivateDiscussionListState","PrivateDiscussionList","DiscussionList","_defineProperties","props","descriptor","configurable","writable","PrivateComposing","Constructor","protoProps","staticProps","action","reject","LogInModal","itemClassName","disabled","canStartDiscussion","PrivateDiscussionsUserPage","changeSort","list","sort","handleChangeSort","loadUser","listItems","actionItems","viewItems","composing","sortMap","sortOptions","Dropdown","buttonClassName","routes","byobuUserPrivate","path","byobuPrivate","IndexPage","setTitle","compose","replace","PrivateDiscussionsPage","PrivateDiscussionNotification","notification","subject","fromUser","Notification","PrivateDiscussionReplyNotification","postNumber","PrivateDiscussionUserLeftNotification","PrivateDiscussionAddedNotification","grid","NotificationGrid","modals","discussions","initializers","postComponents","recipientsModified","recipientLeft","events","pages","notificationComponents","byobuPrivateDiscussionCreated","byobuPrivateDiscussionReplied","PrivateDiscussionRepliedNotification","byobuRecipientRemoved","byobuPrivateDiscussionAdded","notifications"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 45);\n","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/models/User'];","module.exports = flarum.core.compat['common/utils/ItemList'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/models/Group'];","module.exports = flarum.core.compat['common/models/Discussion'];","module.exports = flarum.core.compat['forum/components/Notification'];","module.exports = flarum.core.compat['common/utils/classList'];","module.exports = flarum.core.compat['common/components/LinkButton'];","module.exports = flarum.core.compat['forum/states/DiscussionListState'];","module.exports = flarum.core.compat['forum/components/IndexPage'];","module.exports = flarum.core.compat['common/components/Badge'];","module.exports = flarum.core.compat['forum/components/EventPost'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/helpers/highlight'];","module.exports = flarum.core.compat['forum/components/UserPage'];","module.exports = flarum.core.compat['common/helpers/listItems'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['forum/components/SettingsPage'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['forum/components/DiscussionListItem'];","module.exports = flarum.core.compat['forum/components/DiscussionHero'];","module.exports = flarum.core.compat['forum/utils/DiscussionControls'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['forum/states/SearchState'];","module.exports = flarum.core.compat['forum/components/Search'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['forum/utils/UserControls'];","module.exports = flarum.core.compat['forum/components/DiscussionComposer'];","module.exports = flarum.core.compat['common/components/Dropdown'];","module.exports = flarum.core.compat['forum/components/DiscussionList'];","module.exports = flarum.core.compat['forum/components/LogInModal'];","module.exports = flarum.core.compat['forum/components/NotificationGrid'];","import EventPost from 'flarum/forum/components/EventPost';\n\nexport default class RecipientLeft extends EventPost {\n    static initAttrs(attrs) {\n        super.initAttrs(attrs);\n    }\n\n    icon() {\n        return app.forum.data.attributes['byobu.icon-postAction'];\n    }\n\n    descriptionKey() {\n        return 'fof-byobu.forum.post.recipients_modified.removed_self';\n    }\n}\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import type * as Mithril from 'mithril';\nimport username from 'flarum/common/helpers/username';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport classList from 'flarum/common/utils/classList';\nimport app from 'flarum/forum/app';\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\n\nexport interface IRecipientLabelAttrs extends ComponentAttrs, Mithril.Attributes {\n    recipient: User | Group;\n    link: string;\n}\n\nexport default class RecipientLabel extends Component<IRecipientLabelAttrs> {\n    view(vnode: Mithril.Vnode) {\n        const { recipient, link, ...newAttrs } = this.attrs;\n\n        newAttrs.style = newAttrs.style || {};\n        newAttrs.className = classList('RecipientLabel', newAttrs?.className);\n        newAttrs.href = link;\n\n        let label: string;\n\n        if (recipient instanceof User) {\n            label = username(recipient);\n\n            if (!newAttrs.href && recipient.id() !== app?.session?.user?.id()) {\n                newAttrs.href = app.route.user(recipient);\n            }\n        } else if (recipient instanceof Group) {\n            return <span class={newAttrs.className}>{recipient.namePlural()}</span>;\n        } else {\n            newAttrs.className += ' none';\n            label = app.translator.trans('flarum.core.lib.username.deleted_text');\n        }\n\n        return <LinkButton {...newAttrs}>{label}</LinkButton>;\n    }\n}\n","import Group from 'flarum/common/models/Group';\nimport User from 'flarum/common/models/User';\nimport classList from 'flarum/common/utils/classList';\nimport RecipientLabel from './RecipientLabel';\n\nexport default function recipientsLabel(recipients?: (User | Group)[], attrs: Record<string, unknown> = {}): JSX.Element {\n    const { link, className, ...otherAttrs } = attrs;\n\n    otherAttrs.className = classList('RecipientsLabel', className);\n\n    return (\n        <span {...otherAttrs}>\n            {recipients?.map((recipient) => {\n                const type = recipient instanceof User ? 'u' : 'g';\n\n                return <RecipientLabel key={`${type}-${recipient.id()}`} recipient={recipient} link={link} />;\n            })}\n            {!recipients && <RecipientLabel />}\n        </span>\n    );\n}\n","import EventPost from 'flarum/forum/components/EventPost';\nimport recipientsLabel from '../pages/labels/recipientsLabels';\n\nexport default class RecipientsModified extends EventPost {\n    static initAttrs(attrs) {\n        super.initAttrs(attrs);\n\n        function diff(diff1, diff2, store) {\n            return diff1.filter((item) => diff2.indexOf(item) === -1).map((id) => app.store.getById(store, id));\n        }\n\n        const content = attrs.post.content();\n\n        // For event posts existing before groups functionality.\n        if (!content['new'] && content.length == 2) {\n            const oldRecipients = attrs.post.content()[0];\n            const newRecipients = attrs.post.content()[1];\n            attrs.added = diff(newRecipients, oldRecipients, 'users');\n            attrs.removed = diff(oldRecipients, newRecipients, 'users');\n        } else {\n            let usersAdded = diff(content['new']['users'], content['old']['users'], 'users');\n            let usersRemoved = diff(content['old']['users'], content['new']['users'], 'users');\n            let groupsAdded = diff(content['new']['groups'], content['old']['groups'], 'groups');\n            let groupsRemoved = diff(content['old']['groups'], content['new']['groups'], 'groups');\n\n            attrs.added = usersAdded.concat(groupsAdded);\n            attrs.removed = usersRemoved.concat(groupsRemoved);\n        }\n    }\n\n    icon() {\n        return app.forum.data.attributes['byobu.icon-postAction'];\n    }\n\n    descriptionKey() {\n        var localeBase = 'fof-byobu.forum.post.recipients_modified.';\n\n        if (this.attrs.added.length) {\n            if (this.attrs.removed.length) {\n                return localeBase + 'added_and_removed';\n            }\n\n            return localeBase + 'added';\n        }\n\n        return localeBase + 'removed';\n    }\n\n    descriptionData() {\n        const data = {};\n\n        if (this.attrs.added.length) {\n            data.added = recipientsLabel(this.attrs.added, { link: true });\n        }\n\n        if (this.attrs.removed.length) {\n            data.removed = recipientsLabel(this.attrs.removed, { link: true });\n        }\n\n        return data;\n    }\n}\n","import { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport Switch from 'flarum/common/components/Switch';\n\nexport default (app) => {\n    privacyToggle(app);\n};\n\nfunction privacyToggle(app) {\n    extend(SettingsPage.prototype, 'privacyItems', function (items) {\n        items.add(\n            'byobu-block-dm',\n            Switch.component(\n                {\n                    state: this.user.blocksPd(),\n                    onchange: (value) => {\n                        this.blocksPdLoading = true;\n\n                        this.user.save({ blocksPd: value }).then(() => {\n                            this.blocksPdLoading = false;\n                            m.redraw();\n                        });\n                    },\n                    loading: this.blocksPdLoading,\n                },\n                app.translator.trans('fof-byobu.forum.user.settings.block_pd')\n            )\n        );\n    });\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import highlight from 'flarum/common/helpers/highlight';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\n\nexport default class UserSearchSource {\n    view(query) {\n        if (query.length < 3 || this.loading) return;\n\n        if (!app.cache.byobuResults) {\n            app.cache.byobuResults = [];\n        }\n\n        this.query = query;\n\n        if (!app.cache.byobuResults[this.query]) {\n            this.loading = true;\n\n            app.cache.byobuResults[this.query] = [];\n            app.store\n                .find('users', {\n                    filter: { q: this.query + ' allows-pd' },\n                    page: { limit: 5 },\n                })\n                .then(this.pushResults.bind(this));\n        } else\n            return [\n                <li className=\"Dropdown-header\">{app.translator.trans('core.forum.search.users_heading')}</li>,\n                app.cache.byobuResults[this.query].map((user) => {\n                    const name = username(user);\n                    const children = [highlight(name.text, this.query)];\n\n                    return (\n                        <li className=\"SearchResult\" data-index={'users:' + user.id()}>\n                            <a data-index={'users:' + user.id()}>\n                                {avatar(user)}\n                                {{ ...name, text: undefined, children }}\n                            </a>\n                        </li>\n                    );\n                }),\n            ];\n    }\n\n    pushResults(results) {\n        results.payload.data.map((result) => {\n            var user = app.store.getById('users', result.id);\n            app.cache.byobuResults[this.query].push(user);\n        });\n        this.loading = false;\n        m.redraw();\n    }\n}\n","import highlight from 'flarum/common/helpers/highlight';\n\nexport default class GroupSearchSource {\n    search(query) {\n        return app.store.find('groups', {\n            filter: { q: query },\n            page: { limit: 5 },\n        });\n    }\n\n    view(query) {\n        query = query.toLowerCase();\n\n        const results = app.store.all('groups').filter((group) => group.namePlural().toLowerCase().substr(0, query.length) === query);\n\n        if (!results.length) return '';\n\n        return [\n            <li className=\"Dropdown-header\">{app.translator.trans('fof-byobu.forum.search.headings.groups')}</li>,\n            results.map((group) => {\n                const groupName = group.namePlural();\n                var name = highlight(groupName, query);\n\n                return (\n                    <li className=\"SearchResult\" data-index={'groups:' + group.id()}>\n                        <a data-index={'groups:' + group.id()}>\n                            <span class=\"groupName\">{name}</span>\n                        </a>\n                    </li>\n                );\n            }),\n        ];\n    }\n}\n","import app from 'flarum/forum/app';\nimport Search from 'flarum/forum/components/Search';\nimport UserSearchSource from './sources/UserSearchSource';\nimport GroupSearchSource from './sources/GroupSearchSource';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport RecipientLabel from '../pages/labels/RecipientLabel';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport default class RecipientSearch extends Search {\n    /**\n     * Used to prevent duplicate IDs. Doesn't remove the possibility, but is extremely low.\n     */\n    inputUuid;\n\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.inputUuid = Math.random().toString(36).substring(2);\n    }\n\n    oncreate(vnode) {\n        super.oncreate(vnode);\n\n        const $search = this;\n\n        this.$('.Search-results').on('click', (e) => {\n            const target = this.$('.SearchResult.active');\n\n            $search.addRecipient(target.data('index'));\n            $search.$('.RecipientsInput').focus();\n        });\n\n        this.$('.Search-results').on('touchstart', (e) => {\n            const target = this.$(e.target.parentNode);\n\n            $search.addRecipient(target.data('index'));\n            $search.$('.RecipientsInput').focus();\n        });\n\n        $('.RecipientsInput')\n            .on('input', () => {\n                clearTimeout(this.typingTimer);\n                this.doSearch = false;\n                this.typingTimer = setTimeout(() => {\n                    this.doSearch = true;\n                    m.redraw();\n                }, 900);\n            })\n            .on('keydown', () => {\n                clearTimeout(this.typingTimer);\n            });\n\n        super.oncreate(vnode);\n    }\n\n    view() {\n        if (typeof this.state.getValue() === 'undefined') {\n            this.state.setValue('');\n        }\n\n        const loading = this.state.getValue() && this.state.getValue().length >= 3;\n\n        if (!this.sources) {\n            this.sources = this.sourceItems().toArray();\n        }\n\n        return (\n            <div role=\"search\" className=\"Search\">\n                <div className=\"RecipientsInput-selected RecipientsLabel\" aria-live=\"polite\">\n                    <h4>{app.translator.trans('fof-byobu.forum.modal.labels.selected_users')}</h4>\n                    <p>{app.translator.trans('fof-byobu.forum.modal.help.selected_users')}</p>\n\n                    {this.attrs\n                        .selected()\n                        .toArray()\n                        .map((recipient) => {\n                            return (\n                                <Tooltip text={app.translator.trans('fof-byobu.forum.modal.help.click_user_to_remove_tooltip')}>\n                                    <RecipientLabel data-container=\"body\" recipient={recipient} onclick={(e) => this.removeRecipient(recipient, e)} />\n                                </Tooltip>\n                            );\n                        })}\n                </div>\n\n                <div className=\"Form-group\">\n                    <label for={`byobu-addrecipient-search-input-${this.inputUuid}`}>\n                        {app.translator.trans('fof-byobu.forum.modal.labels.search_field')}\n                    </label>\n\n                    <div className=\"AddRecipientModal-form-input Search-input\">\n                        <input\n                            id={`byobu-addrecipient-search-input-${this.inputUuid}`}\n                            className={classList('RecipientsInput', 'FormControl', {\n                                open: !!this.state.getValue(),\n                                focused: !!this.state.getValue(),\n                                active: !!this.state.getValue(),\n                                loading: !!this.loadingSources,\n                            })}\n                            oncreate={(vnode) => vnode.dom.focus()}\n                            type=\"search\"\n                            placeholder={extractText(app.translator.trans('fof-byobu.forum.input.search_recipients'))}\n                            value={this.state.getValue()}\n                            oninput={(e) => this.state.setValue(e.target.value)}\n                            onfocus={() => (this.hasFocus = true)}\n                            onblur={() => (this.hasFocus = false)}\n                        />\n                        <ul\n                            className={classList('Dropdown-menu', 'Search-results', 'fade', {\n                                in: !!loading,\n                            })}\n                        >\n                            {!this.doSearch\n                                ? LoadingIndicator.component({ size: 'tiny', className: 'Button Button--icon Button--link' })\n                                : this.sources.map((source) => source.view(this.state.getValue()))}\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    /**\n     * Build an item list of SearchSources.\n     *\n     * @return {ItemList}\n     */\n    sourceItems() {\n        const items = new ItemList();\n\n        // Add user source based on permissions.\n        if (\n            (!this.attrs.discussion && app.forum.attribute('canStartPrivateDiscussionWithUsers')) ||\n            (this.attrs.discussion && this.attrs.discussion.canEditUserRecipients())\n        ) {\n            items.add('users', new UserSearchSource());\n        }\n\n        // Add group source based on permissions.\n        if (\n            (!this.attrs.discussion && app.forum.attribute('canStartPrivateDiscussionWithGroups')) ||\n            (this.attrs.discussion && this.attrs.discussion.canEditGroupRecipients())\n        ) {\n            items.add('groups', new GroupSearchSource());\n        }\n\n        return items;\n    }\n\n    /**\n     * Adds a recipient.\n     *\n     * @param value\n     */\n    addRecipient(value) {\n        let values = value.split(':'),\n            type = values[0],\n            id = values[1];\n\n        let recipient = this.findRecipient(type, id);\n\n        this.attrs.selected().add(value, recipient);\n\n        this.state.clear();\n    }\n\n    /**\n     * Removes a recipient.\n     *\n     * @param recipient\n     */\n    removeRecipient(recipient, e) {\n        e.preventDefault();\n\n        let type;\n\n        if (recipient instanceof User) {\n            type = 'users';\n        }\n        if (recipient instanceof Group) {\n            type = 'groups';\n        }\n\n        this.attrs.selected().remove(type + ':' + recipient.id());\n    }\n\n    /**\n     * Loads a recipient from the global store.\n     *\n     * @param store\n     * @param id\n     * @returns {Model}\n     */\n    findRecipient(store, id) {\n        return app.store.getById(store, id);\n    }\n}\n","import Modal from 'flarum/common/components/Modal';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Stream from 'flarum/common/utils/Stream';\nimport SearchState from 'flarum/forum/states/SearchState';\nimport RecipientSearch from '../search/RecipientSearch';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\n\nexport default class AddRecipientModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.selected = Stream(new ItemList());\n\n        if (this.attrs.discussion) {\n            // Adds recipients of the currently viewed discussion.\n            this.assignInitialRecipients(this.attrs.discussion);\n        } else if (this.attrs.selectedRecipients && this.attrs.selectedRecipients.toArray().length > 0) {\n            // Adds previously selected recipients.\n            this.selected().merge(this.attrs.selectedRecipients);\n        } else {\n            // Adds the current user in case there are no selected recipients yet and this is a new discussion.\n            this.selected().add('users:' + app.session.user.id(), app.session.user);\n        }\n\n        this.recipientSearch = new SearchState();\n    }\n\n    isDismissible() {\n        return false;\n    }\n\n    assignInitialRecipients(discussion) {\n        discussion.recipientUsers().map((user) => {\n            this.selected().add('users:' + user.id(), user);\n        });\n        discussion.recipientGroups().map((group) => {\n            this.selected().add('groups:' + group.id(), group);\n        });\n    }\n\n    className() {\n        return 'AddRecipientModal';\n    }\n\n    title() {\n        return this.attrs.discussion\n            ? app.translator.trans('fof-byobu.forum.modal.titles.update_recipients', { title: <em>{this.attrs.discussion.title()}</em> })\n            : app.translator.trans('fof-byobu.forum.modal.titles.add_recipients');\n    }\n\n    helpText() {\n        return this.attrs.discussion\n            ? app.translator.trans('fof-byobu.forum.modal.help.update_recipients')\n            : app.translator.trans('fof-byobu.forum.modal.help.add_recipients');\n    }\n\n    content() {\n        return [\n            <div className=\"Modal-body\">\n                <div class=\"AddRecipientModal-help\">{this.helpText()}</div>\n                <div className=\"AddRecipientModal-form\">\n                    {RecipientSearch.component({\n                        state: this.recipientSearch,\n                        selected: this.selected,\n                        discussion: this.attrs.discussion,\n                    })}\n                    <div className=\"AddRecipientModal-form-submit App-primaryControl\">\n                        {Button.component(\n                            {\n                                type: 'submit',\n                                className: 'Button Button--primary',\n                                icon: 'fas fa-check',\n                            },\n                            app.translator.trans('fof-byobu.forum.buttons.submit')\n                        )}\n                        {Button.component(\n                            {\n                                onclick: this.hide.bind(this),\n                                className: 'Button Button--cancel',\n                            },\n                            app.translator.trans('fof-byobu.forum.buttons.cancel')\n                        )}\n                    </div>\n                </div>\n            </div>,\n        ];\n    }\n\n    select(e) {\n        // Ctrl + Enter submits the selection, just Enter completes the current entry\n        if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\n            if (this.selected().length) {\n                this.$('form').submit();\n            }\n        }\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        const discussion = this.attrs.discussion;\n        const recipients = this.selected();\n\n        let recipientGroups = [];\n        let recipientUsers = [];\n\n        recipients.toArray().forEach((recipient) => {\n            if (recipient instanceof User) {\n                recipientUsers.push(recipient);\n            }\n            if (recipient instanceof Group) {\n                recipientGroups.push(recipient);\n            }\n        });\n\n        // Recipients are updated here for existing discussions here.\n        if (discussion) {\n            discussion.save({ relationships: { recipientUsers, recipientGroups } }).then(() => {\n                if (app.current instanceof DiscussionPage) {\n                    app.current.stream.update();\n                }\n                m.redraw();\n            });\n        }\n\n        // Use the onsubmit callback to trigger an update in the DiscussionComposer\n        if (this.attrs.onsubmit) this.attrs.onsubmit(recipients);\n\n        app.modal.close();\n\n        if (!this.attrs.discussion) {\n            app.composer.show();\n        }\n\n        e.redraw = false;\n    }\n}\n","import { extend } from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\nimport Badge from 'flarum/common/components/Badge';\nimport Discussion from 'flarum/common/models/Discussion';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\nimport Button from 'flarum/common/components/Button';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionHero from 'flarum/forum/components/DiscussionHero';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport recipientsLabel from '../pages/labels/recipientsLabels';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport AddRecipientModal from './../modals/AddRecipientModal';\n\nexport default () => {\n    attributes();\n    badges();\n    index();\n    hero();\n    apiInclude();\n    controls();\n};\n\nconst add = function (discussion, items, long) {\n    let recipients = [];\n\n    if (discussion.recipientUsers().length) {\n        recipients = recipients.concat(discussion.recipientUsers());\n    }\n\n    if (discussion.recipientGroups().length) {\n        recipients = recipients.concat(discussion.recipientGroups());\n    }\n\n    if (recipients && recipients.length) {\n        if (long) {\n            items.add('recipients', recipientsLabel(recipients), 10);\n        } else {\n            items.add('recipients', recipientsLabel(recipients, { link: true }), 4);\n        }\n    }\n};\n\nfunction badges() {\n    extend(Discussion.prototype, 'badges', function (badges) {\n        if (this.recipientUsers().length || this.recipientGroups().length) {\n            badges.add(\n                'private',\n                Badge.component({\n                    type: 'private',\n                    label: app.translator.trans('fof-byobu.forum.badges.is_private.tooltip'),\n                    icon: app.forum.data.attributes['byobu.icon-badge'],\n                }),\n                10\n            );\n        }\n    });\n}\n\nfunction index() {\n    extend(DiscussionListItem.prototype, 'infoItems', function (items) {\n        const discussion = this.attrs.discussion;\n\n        add(discussion, items, true);\n    });\n}\n\nfunction hero() {\n    extend(DiscussionHero.prototype, 'items', function (items) {\n        const discussion = this.attrs.discussion;\n\n        add(discussion, items, false);\n    });\n}\n\nfunction apiInclude() {\n    extend(DiscussionListState.prototype, 'requestParams', function (params) {\n        params.include.push('recipientUsers');\n        params.include.push('recipientGroups');\n    });\n}\n\nfunction controls() {\n    extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n        if (discussion.canEditRecipients()) {\n            items.add(\n                'recipients',\n                Button.component(\n                    {\n                        icon: app.forum.data.attributes['byobu.icon-badge'],\n                        onclick: () => app.modal.show(AddRecipientModal, { discussion }),\n                    },\n                    app.translator.trans('fof-byobu.forum.buttons.edit_recipients')\n                )\n            );\n        }\n        if (discussion && discussion.recipientUsers().find((user) => user.id() === app.session.user.id())) {\n            items.add(\n                'remove',\n                Button.component(\n                    {\n                        icon: 'fas fa-user-slash',\n                        onclick: () => {\n                            if (discussion) {\n                                let recipients = new ItemList();\n                                discussion.recipientUsers().map((user) => {\n                                    if (app.session.user.id() !== user.id()) {\n                                        recipients.add('users:' + user.id(), user);\n                                    }\n                                });\n\n                                let recipientGroups = [];\n                                let recipientUsers = [];\n\n                                recipients.toArray().forEach((recipient) => {\n                                    if (recipient instanceof User) {\n                                        recipientUsers.push(recipient);\n                                    }\n                                    if (recipient instanceof Group) {\n                                        recipientGroups.push(recipient);\n                                    }\n                                });\n\n                                discussion\n                                    .save({\n                                        relationships: {\n                                            recipientUsers,\n                                            recipientGroups,\n                                        },\n                                    })\n                                    .then(() => app.history.back());\n                            }\n                        },\n                    },\n                    app.translator.trans('fof-byobu.forum.buttons.remove_from_discussion')\n                )\n            );\n        }\n    });\n}\n\nfunction attributes() {\n    Discussion.prototype.recipientUsers = Model.hasMany('recipientUsers');\n    Discussion.prototype.oldRecipientUsers = Model.hasMany('oldRecipientUsers');\n    Discussion.prototype.recipientGroups = Model.hasMany('recipientGroups');\n    Discussion.prototype.oldRecipientGroups = Model.hasMany('oldRecipientGroups');\n\n    Discussion.prototype.canEditRecipients = Model.attribute('canEditRecipients');\n    Discussion.prototype.canEditUserRecipients = Model.attribute('canEditUserRecipients');\n    Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\n    Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\n}\n","import DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport AddRecipientModal from '../../modals/AddRecipientModal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport recipientCountLabel from '../labels/recipientCountLabel';\nimport User from 'flarum/common/models/User';\nimport Group from 'flarum/common/models/Group';\n\nexport default class PrivateDiscussionComposer extends DiscussionComposer {\n    static initAttrs(attrs) {\n        super.initAttrs(attrs);\n\n        attrs.titlePlaceholder = app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder');\n        attrs.submitLabel = app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button');\n    }\n\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.composer.fields.recipients = this.attrs.recipients || new ItemList();\n\n        this.composer.fields.recipientUsers = this.attrs.recipientUsers || [];\n        this.composer.fields.recipientGroups = this.attrs.recipientGroups || [];\n\n        const username = m.route.param('username');\n\n        if (typeof username !== 'undefined') {\n            this.addDefaultRecipients(username);\n        }\n    }\n\n    data() {\n        let data = super.data();\n\n        const users = [];\n        const groups = [];\n\n        if (this.composer.fields.recipients !== undefined) {\n            this.composer.fields.recipients.toArray().forEach((recipient) => {\n                if (recipient instanceof User) {\n                    users.push(recipient);\n                }\n\n                if (recipient instanceof Group) {\n                    groups.push(recipient);\n                }\n            });\n        }\n\n        data.relationships = data.relationships || {};\n\n        if (users.length) {\n            data.relationships.recipientUsers = users;\n        }\n\n        if (groups.length) {\n            data.relationships.recipientGroups = groups;\n        }\n\n        delete data.relationships.tags;\n\n        return data;\n    }\n\n    chooseRecipients() {\n        app.modal.show(AddRecipientModal, {\n            selectedRecipients: this.composer.fields.recipients,\n            onsubmit: (recipients) => {\n                this.composer.fields.recipients = recipients;\n\n                // Focus on recipient autocomplete field.\n                this.$('.RecipientsInput').focus();\n            },\n        });\n    }\n\n    headerItems() {\n        let items = super.headerItems();\n\n        items.remove('tags');\n\n        if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\n            const recipients = this.composer.fields.recipients.toArray();\n\n            items.add(\n                'recipients',\n                <a className=\"PrivateDiscussionComposer-changeRecipients\" onclick={this.chooseRecipients.bind(this)}>\n                    {recipients.length ? (\n                        recipientCountLabel(recipients.length)\n                    ) : (\n                        <span className=\"RecipientLabel none\">{app.translator.trans('fof-byobu.forum.buttons.add_recipients')}</span>\n                    )}\n                </a>,\n                5\n            );\n        }\n\n        return items;\n    }\n\n    addDefaultRecipients(username) {\n        const user = app.store.getBy('users', 'username', username);\n\n        this.composer.fields.recipients.add('users:' + app.session.user.id(), app.session.user);\n\n        if (user.id() !== app.session.user.id()) {\n            this.composer.fields.recipients.add('users:' + user.id(), user);\n        }\n    }\n\n    onsubmit() {\n        this.loading = true;\n\n        const recipients = this.composer.fields.recipients.toArray();\n\n        if (recipients.length < 2) {\n            this.chooseRecipients();\n\n            this.loading = false;\n        } else {\n            const data = this.data();\n\n            app.store\n                .createRecord('discussions')\n                .save(data)\n                .then((discussion) => {\n                    if (app.cache.discussionList) {\n                        app.cache.discussionList.refresh();\n                    }\n                    m.route.set(app.route.discussion(discussion));\n\n                    app.composer.hide();\n                }, this.loaded.bind(this));\n        }\n    }\n}\n","export default function recipientCountLabel(count, attrs = {}) {\n    attrs.style = attrs.style || {};\n    attrs.className = 'RecipientLabel ' + (attrs.className || '');\n\n    var label = app.translator.trans('fof-byobu.forum.labels.recipients', { count });\n\n    return m('span', attrs, <span className=\"RecipientLabel-text\">{label}</span>);\n}\n","import { extend } from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport PrivateDiscussionComposer from './../pages/discussions/PrivateDiscussionComposer';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport LinkButton from 'flarum/common/components/LinkButton';\n\nexport default (app) => {\n    attributes();\n    message(app);\n    sharedMessageHistory(app);\n};\n\nfunction message(app) {\n    extend(UserControls, 'userControls', function (items, user) {\n        if (\n            app.session.user &&\n            app.session.user.id() !== user.id() &&\n            app.forum.attribute('canStartPrivateDiscussion') &&\n            (user.blocksPd() === false || (app.forum.attribute('canStartPrivateDiscussionWithBlockers') && user.cannotBeDirectMessaged()))\n        ) {\n            items.add(\n                'private-discussion',\n                Button.component(\n                    {\n                        icon: app.forum.data.attributes['byobu.icon-badge'],\n                        onclick: (e) => {\n                            e.preventDefault();\n\n                            return new Promise((resolve) => {\n                                let recipients = new ItemList();\n                                recipients.add('users:' + app.session.user.id(), app.session.user);\n                                recipients.add('users:' + user.id(), user);\n\n                                PrivateDiscussionComposer.prototype.recipients = recipients;\n\n                                app.composer.load(PrivateDiscussionComposer, {\n                                    user: app.session.user,\n                                    recipients: recipients,\n                                    recipientUsers: recipients,\n                                    titlePlaceholder: app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder'),\n                                    submitLabel: app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button'),\n                                });\n                                app.composer.show();\n\n                                return resolve(app.composer);\n                            });\n                        },\n                    },\n                    app.translator.trans('fof-byobu.forum.buttons.send_pd', { username: user.username() })\n                )\n            );\n        }\n\n        return items;\n    });\n}\n\nfunction sharedMessageHistory(app) {\n    extend(UserPage.prototype, 'navItems', function (items) {\n        const href = app.route('byobuUserPrivate', { username: this.user.username() });\n\n        // Hide links from guests if they are not already on the page\n        if (!app.session.user && m.route.get() !== href) return;\n        // Hide link for your own page.\n        if (app.session.user && app.session.user.username() === this.user.username()) return;\n\n        items.add(\n            'byobu',\n            LinkButton.component(\n                {\n                    href,\n                    icon: app.forum.data.attributes['byobu.icon-badge'],\n                },\n                app.translator.trans('fof-byobu.forum.user.byobu_link')\n            ),\n            85\n        );\n    });\n}\n\nfunction attributes() {\n    User.prototype.blocksPd = Model.attribute('blocksPd');\n    User.prototype.cannotBeDirectMessaged = Model.attribute('cannotBeDirectMessaged');\n    User.prototype.unreadPrivateMessagesCount = Model.attribute('unreadPrivateMessagesCount');\n}\n","import SettingsPage from './SettingsPage';\nimport Discussion from './Discussion';\nimport User from './User';\n\nexport default (app) => {\n    Discussion(app);\n    SettingsPage(app);\n    User(app);\n};\n","import DiscussionListState from 'flarum/forum/states/DiscussionListState';\n\nexport default class PrivateDiscussionListState extends DiscussionListState {}\n","import DiscussionList from 'flarum/forum/components/DiscussionList';\n\nexport default class PrivateDiscussionList extends DiscussionList {}\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import Button from 'flarum/common/components/Button';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport PrivateDiscussionComposer from './discussions/PrivateDiscussionComposer';\n\nexport default class PrivateComposing {\n    constructor(recipient) {\n        this.recipient = recipient;\n    }\n\n    action(e) {\n        e.preventDefault();\n\n        return new Promise((resolve, reject) => {\n            if (app.session.user) {\n                let recipients = new ItemList();\n\n                recipients.add('users:' + app.session.user.id(), app.session.user);\n\n                if (this.recipient && app.session.user.id() !== this.recipient.id()) {\n                    recipients.add('users:' + this.recipient.id(), this.recipient);\n                }\n\n                app.composer.load(PrivateDiscussionComposer, {\n                    user: app.session.user,\n                    recipients: recipients,\n                    recipientUsers: recipients,\n                });\n\n                app.composer.show();\n\n                return resolve();\n            } else {\n                app.modal.show(LogInModal);\n\n                return reject();\n            }\n        });\n    }\n\n    component() {\n        return Button.component(\n            {\n                icon: 'fas fa-pen',\n                className: 'Button Button--primary IndexPage-newDiscussion',\n                itemClassName: 'fof-byobu_primaryControl',\n                onclick: this.action.bind(this),\n                disabled: !this.canStartDiscussion,\n            },\n            app.translator.trans(this.canStartDiscussion ? 'fof-byobu.forum.nav.start_button' : 'core.forum.index.cannot_start_discussion_button')\n        );\n    }\n\n    get canStartDiscussion() {\n        return app.session.user && app.forum.attribute('canStartPrivateDiscussion');\n    }\n}\n","import UserPage from 'flarum/forum/components/UserPage';\nimport PrivateDiscussionListState from '../states/PrivateDiscussionListState';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport listItems from 'flarum/common/helpers/listItems';\nimport PrivateDiscussionList from './discussions/PrivateDiscussionList';\nimport PrivateComposing from './PrivateComposing';\n\nexport default class PrivateDiscussionsUserPage extends UserPage {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.changeSort('latest');\n    }\n\n    show(user) {\n        // We can not create the list in init because the user will not be available if it has to be loaded asynchronously\n        this.list = new PrivateDiscussionListState({\n            q: `byobu:${user.username()} is:private`,\n            sort: this.sort,\n        });\n\n        this.list.refresh();\n\n        // We call the parent method after creating the list, this way the this.list property\n        // is set before content() is called for the first time\n        super.show(user);\n    }\n\n    handleChangeSort(sort, e) {\n        e.preventDefault();\n\n        this.changeSort(sort);\n    }\n\n    changeSort(sort) {\n        this.sort = sort;\n        this.loadUser(m.route.param('username'));\n    }\n\n    content() {\n        return (\n            <div className=\"DiscussionsUserPage\">\n                <div className=\"DiscussionsUserPage-toolbar\">\n                    <ul className=\"DiscussionsUserPage-toolbar-action\">{listItems(this.actionItems().toArray())}</ul>\n                    <ul className=\"DiscussionsUserPage-toolbar-view\">{listItems(this.viewItems().toArray())}</ul>\n                </div>\n                <PrivateDiscussionList state={this.list}></PrivateDiscussionList>\n            </div>\n        );\n    }\n\n    actionItems() {\n        let composing = new PrivateComposing(this.user);\n\n        const items = new ItemList();\n\n        if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\n            items.add('start_private', composing.component());\n        }\n\n        return items;\n    }\n\n    viewItems() {\n        const items = new ItemList();\n        const sortMap = this.list.sortMap();\n\n        const sortOptions = {};\n        for (const i in sortMap) {\n            sortOptions[i] = app.translator.trans('core.forum.index_sort.' + i + '_button');\n        }\n\n        items.add(\n            'sort',\n            Dropdown.component(\n                {\n                    buttonClassName: 'Button',\n                    label: sortOptions[this.sort] || Object.keys(sortMap).map((key) => sortOptions[key])[0],\n                },\n                Object.keys(sortOptions).map((value) => {\n                    const label = sortOptions[value];\n                    const active = (this.sort || Object.keys(sortMap)[0]) === value;\n\n                    return Button.component(\n                        {\n                            icon: active ? 'fas fa-check' : true,\n                            onclick: this.handleChangeSort.bind(this, value),\n                            active: active,\n                        },\n                        label\n                    );\n                })\n            )\n        );\n\n        return items;\n    }\n}\n","import routes from './routes';\nimport PrivateDiscussionsPage from './PrivateDiscussionsPage';\n\nexport default (app) => {\n    routes(app);\n    PrivateDiscussionsPage(app);\n};\n","import IndexPage from 'flarum/forum/components/IndexPage';\nimport PrivateDiscussionsUserPage from './PrivateDiscussionsUserPage';\n\nexport default (app) => {\n    app.routes.byobuUserPrivate = { path: '/u/:username/private', component: PrivateDiscussionsUserPage };\n    app.routes.byobuPrivate = { path: '/private', component: IndexPage };\n};\n","import { extend } from 'flarum/common/extend';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport PrivateComposing from './PrivateComposing';\n\nexport default (app) => {\n    extend(IndexPage.prototype, 'navItems', (items) => {\n        const user = app.session.user;\n\n        if (user) {\n            items.add(\n                'privateDiscussions',\n                LinkButton.component(\n                    {\n                        icon: app.forum.data.attributes['byobu.icon-badge'],\n                        href: app.route('byobuPrivate'),\n                    },\n                    app.translator.trans('fof-byobu.forum.nav.nav_item')\n                ),\n                75\n            );\n        }\n    });\n\n    extend(IndexPage.prototype, 'setTitle', function () {\n        if (app.current.get('routeName') === 'byobuPrivate') {\n            app.setTitle(app.translator.trans('fof-byobu.forum.user.dropdown_label'));\n        }\n    });\n\n    extend(DiscussionListState.prototype, 'requestParams', function (params) {\n        if (app.current.get('routeName') === 'byobuPrivate') {\n            params.filter.q = (params.filter.q || '') + ' is:private';\n\n            params.include.push('recipientUsers');\n            params.include.push('recipientGroups');\n        }\n    });\n\n    extend(IndexPage.prototype, 'sidebarItems', function (items) {\n        if (app.current.get('routeName') === 'byobuPrivate') {\n            let compose = new PrivateComposing();\n\n            items.replace('newDiscussion', compose.component());\n        }\n    });\n};\n","import Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionNotification extends Notification {\n    icon() {\n        return app.forum.data.attributes['byobu.icon-badge'];\n    }\n\n    href() {\n        const notification = this.attrs.notification;\n        const discussion = notification.subject();\n\n        return app.route.discussion(discussion);\n    }\n\n    content() {\n        const user = this.attrs.notification.fromUser();\n        return app.translator.trans('fof-byobu.forum.notifications.pd_text', {\n            user: user,\n        });\n    }\n}\n","import Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionReplyNotification extends Notification {\n    icon() {\n        return 'fas fa-reply';\n    }\n\n    href() {\n        const notification = this.attrs.notification;\n        const discussion = notification.subject();\n        const content = notification.content() || {};\n\n        return app.route.discussion(discussion, content.postNumber);\n    }\n\n    content() {\n        const user = this.attrs.notification.fromUser();\n        return app.translator.trans('fof-byobu.forum.notifications.pd_reply_text', {\n            user: user,\n        });\n    }\n}\n","import Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionUserLeftNotification extends Notification {\n    icon() {\n        return app.forum.data.attributes['byobu.icon-badge'];\n    }\n\n    href() {\n        const notification = this.attrs.notification;\n        const discussion = notification.subject();\n\n        return app.route.discussion(discussion);\n    }\n\n    content() {\n        const user = this.attrs.notification.fromUser();\n        return app.translator.trans('fof-byobu.forum.notifications.pd_user_left_text', {\n            user: user,\n        });\n    }\n}\n","import Notification from 'flarum/forum/components/Notification';\n\nexport default class PrivateDiscussionAddedNotification extends Notification {\n    icon() {\n        return app.forum.data.attributes['byobu.icon-badge'];\n    }\n\n    href() {\n        const notification = this.attrs.notification;\n        const discussion = notification.subject();\n\n        return app.route.discussion(discussion);\n    }\n\n    content() {\n        const user = this.attrs.notification.fromUser();\n        return app.translator.trans('fof-byobu.forum.notifications.pd_added_text', {\n            user: user,\n        });\n    }\n}\n","import { extend } from 'flarum/common/extend';\nimport NotificationGrid from 'flarum/forum/components/NotificationGrid';\nimport PrivateDiscussionNotification from './PrivateDiscussionNotification';\nimport PrivateDiscussionRepliedNotification from './PrivateDiscussionReplyNotification';\nimport PrivateDiscussionUserLeftNotification from './PrivateDiscussionUserLeftNotification';\nimport PrivateDiscussionAddedNotification from './PrivateDiscussionAddedNotification';\n\nexport default function (app) {\n    app.notificationComponents.byobuPrivateDiscussionCreated = PrivateDiscussionNotification;\n    app.notificationComponents.byobuPrivateDiscussionReplied = PrivateDiscussionRepliedNotification;\n    app.notificationComponents.byobuRecipientRemoved = PrivateDiscussionUserLeftNotification;\n    app.notificationComponents.byobuPrivateDiscussionAdded = PrivateDiscussionAddedNotification;\n\n    grid();\n}\n\nfunction grid() {\n    // Add notification preferences.\n    extend(NotificationGrid.prototype, 'notificationTypes', function (items) {\n        items.add('byobuPrivateDiscussionCreated', {\n            name: 'byobuPrivateDiscussionCreated',\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_label'),\n        });\n        items.add('byobuPrivateDiscussionReplied', {\n            name: 'byobuPrivateDiscussionReplied',\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_reply_label'),\n        });\n        items.add('byobuPrivateDiscussionAdded', {\n            name: 'byobuPrivateDiscussionAdded',\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_added_label'),\n        });\n        items.add('byobuRecipientRemoved', {\n            name: 'byobuRecipientRemoved',\n            icon: app.forum.data.attributes['byobu.icon-badge'],\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_user_left_label'),\n        });\n    });\n}\n","import AddRecipientModal from './AddRecipientModal';\n\nexport const modals = {\n    AddRecipientModal: AddRecipientModal,\n};\n","import PrivateDiscussionComposer from './PrivateDiscussionComposer';\nimport PrivateDiscussionList from './PrivateDiscussionList';\n\nexport const discussions = {\n    PrivateDiscussionComposer: PrivateDiscussionComposer,\n    PrivateDiscussionList: PrivateDiscussionList,\n};\n","import events from './events';\nimport extend from './extend';\nimport pages from './pages';\nimport notifications from './notifications';\n\nexport * from './modals';\nexport * from './pages/discussions';\n\napp.initializers.add('fof-byobu', function (app) {\n    events(app);\n    extend(app);\n\n    pages(app);\n    notifications(app);\n});\n","import RecipientLeft from './RecipientLeft';\nimport RecipientsModified from './RecipientsModified';\n\nexport default (app) => {\n    app.postComponents.recipientsModified = RecipientsModified;\n    app.postComponents.recipientLeft = RecipientLeft;\n};\n"],"sourceRoot":""}